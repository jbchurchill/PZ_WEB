var map,zoom,center,scalebar,checkNull,content;var mdImagelayer,mapLaunchStore,comboBox,flzTemplate,parcelTemplate,addrTemplate,streetTemplate,fpFEMA_task,mdImageBasemap,identifyParams,geocoder;var basemapGallery,layerFEMA,imageParameters;var passedCenter,passedX,passedY,zoomLevel;require(["esri/map","esri/dijit/Scalebar","esri/dijit/Popup","esri/dijit/BasemapGallery","esri/dijit/Basemap","dojo/dom","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/graphic","esri/Color","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/InfoTemplate","esri/dijit/Geocoder","dojo/on","dojo/parser","dojo/domReady!"],function(h,s,m,A,z,c,t,o,G,I,e,a,C,k,l,K,w,p,b,q,L,d,j,i,n,r,D,x,u){u.parse();var v=new m({fillSymbol:new b(b.STYLE_SOLID,new q(q.STYLE_SOLID,new j([255,0,0]),2),new j([255,255,0,0.25]))},dojo.create("div"));function F(){var N=dijit.byId("mapSelect").get("value"),O,M,P;switch(N){case"Measurement":P="_blank";O="measure.php";break;case"Planning and Zoning":O="pz_map.php";P="_blank";break;case"Flood Hazard":O="FEMA_map.php";P="_self";break;case"Sensitive Areas":O="sensitive.php";P="_blank";break;case"Printable":O="printable.php";P="_blank";break}M=O+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(M,P)}function y(){var N=w.webMercatorToGeographic(map.extent.getCenter());passedX=parseFloat(N.x.toFixed(5));passedY=parseFloat(N.y.toFixed(5));zoomLevel=map.getLevel();var M=document.getElementById("centroid");M.innerHTML="Latitude: "+passedY+"<br />Longitude: "+passedX}function H(){var N,M;N=document.querySelector(".esriPopup");if(N){M=new dojo.dnd.Moveable(c.byId(N))}return M}passedCenter=[passedX,passedY];G.byId("launchButton").on("click",F);function f(){dojo.connect(map,"onExtentChange",y)}map=new h("mapDiv",{basemap:"streets",center:passedCenter,zoom:zoomLevel,infoWindow:v});function B(){var P,O,T,S,Q,M,R,N;P=document.getElementById("textLatLong").value;P=P.replace(/\s+/g,"");O=P.indexOf(",");if(O>0){T=parseFloat(P.slice(0,O));S=parseFloat(P.substring(O+1));Q=new L(L.STYLE_SQUARE,12,new q(q.STYLE_SOLID,new j([10,10,10,0.75]),1),new j([255,0,0,0.5]));M=new p(S,T,map.spatialRefernce);R=new d(M,Q,null,null);map.graphics.add(R);if(R.geometry.type==="point"){N=map.getMaxZoom();map.centerAndZoom(R.geometry,N-1)}else{map.setExtent(graphicsUtils.graphicsExtent([R]))}}else{return""}}function J(N){var M=document.getElementById("textLatLong");M.value=N.coords.latitude+", "+N.coords.longitude}function g(){map.graphics.clear();var M=document.getElementById("centroid");if(navigator.geolocation){navigator.geolocation.getCurrentPosition(J)}else{M.innerHTML="Geolocation is not supported by this browser."}}x(c.byId("getLocationButton"),"click",g);scalebar=new s({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});map.on("load",f);x(c.byId("submitLatLongButton"),"click",B);mapLaunchStore=new t({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});comboBox=new o({id:"mapSelect",name:"map",value:"Flood Hazard",store:mapLaunchStore,searchAttr:"name"},"mapSelect").startup();checkNull=function(N,M){function O(Q,R,P){if(Q=="Null"|Q==""){content=""}else{if(P){if(R=='SDAT Link: <a href="'){Q+='" target="_blank">LINK</a>'}if(R=="Subtype: "&Q=="0.2 PCT ANNUAL CHANCE FLOOD HAZARD"){R="";Q=""}Q+="<br />"}content=R+Q}}switch(M){case"SUBDIVSN":O(N,"Subdivision: ",true);break;case"PLAT":O(N,"Plat: ",true);break;case"BLOCK":O(N,"Block: ",true);break;case"PLTLIBER":O(N,'<hr><span class="sectionhead">Plat Reference</span><br />Liber: ',true);break;case"PLTFOLIO":O(N,"Folio: ",true);break;case"OWNNAME2":O(N," ",false);break;case"SDATWEBADR":O(N,'SDAT Link: <a href="',true);break;case"ZONE_SUBTY":O(N,"Subtype: ",true)}return content};flzTemplate=new r("",'<span class="sectionhead">Layer: FEMA Flood Hazard Zones </span><br /><br /><hr>Flood Zone: ${FLD_ZONE2} <br/> ${ZONE_SUBTY:checkNull}');parcelTemplate=new r("",'<span class="sectionhead">Layer: Parcels</span><br /><br /><hr>Address: ${ADDRESS} <br />City: ${CITY} <br /> Owner: ${OWNNAME1} ${OWNNAME2:checkNull} <br /> Tax Id: ${ACCTID} <br /><hr><span class="sectionhead">Deed Reference</span><br />Liber: ${DR1LIBER} <br /> Folio: ${DR1FOLIO} <br /><hr> ${SUBDIVSN:checkNull} ${PLAT:checkNull} ${BLOCK:checkNull} Grid: ${GRID} <br />Map: ${MAP} <br /> Parcel: ${PARCEL} <br /> Lot: ${LOT} <br /> Area: ${ACRES:NumberFormat(places:2)} Acres <br />${PLTLIBER:checkNull} ${PLTFOLIO:checkNull} <hr>Year Built: ${YRBLT_CAMA} <br /> ${SDATWEBADR:checkNull}');addrTemplate=new r("Address Info",'<span class="sectionhead">Layer: Address Points</span><br /><br /><hr>Address: ${ADDRESS} <br /><br /> City: ${CITY} <br /> Zip: ${ZIP_CODE} <br /> ESN: ${ESN} <br /> Community: ${COMMUNITY} <br /> Map: ${MAP} <br /> Parcel: ${PARCEL} <br />Lot: ${LOT} <br /> Tract: ${TRACT} <br /> LU: ${LU} <br /> Key date: ${KEYDATE} <br /> Rental: ${RENTAL} <br />Rental Co.: ${RENTAL_CO} <br /> Tax Account: ${TAX_ACCOUNT_ID} <br /> Owner: ${OWNER_FIRST_NAME} ${OWNER_LAST_NAME} <br />');streetTemplate=new r("",'<span class="sectionhead">Layer: Street Centerlines</span><br /><br /><hr>Name: ${STREET_ALL} <br />Maintenance: ${MAINTENANCE} <br /> Length: ${SHAPE.len:NumberFormat(places:1)} feet <br />');fpFEMA_task=new i("https://maps.garrettcounty.org/arcweb/rest/services/FEMA/FEMA/MapServer/");imageParameters=new K();imageParameters.layerIds=[0,1,2,3];imageParameters.layerOption=K.LAYER_OPTION_SHOW;layerFEMA=new k("https://maps.garrettcounty.org/arcweb/rest/services/FEMA/FEMA/MapServer",{imageParameters:imageParameters,opacity:0.75});map.addLayer(layerFEMA);basemapGallery=new A({showArcGISBasemaps:true,map:map},"basemapGallery");mdImagelayer=new esri.layers.ArcGISTiledMapServiceLayer("https://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/ImageServer");mdImage2011=new esri.layers.ArcGISTiledMapServiceLayer("https://imagery.geodata.md.gov/imap/rest/services/SixInch/SixInchImagery2011_2013/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD 2014 Imagery",thumbnailUrl:"https://maps.garrettcounty.org/arcgis/images/image2014.png"});mdImageBasemap2011=new esri.dijit.Basemap({layers:[mdImage2011],title:"MD 2011 Imagery",thumbnailUrl:"https://maps.garrettcounty.org/arcgis/images/image_v2.png"});basemapGallery.add(mdImageBasemap);basemapGallery.add(mdImageBasemap2011);basemapGallery.startup();basemapGallery.on("error",function(M){console.log("basemap gallery error:  ",M)});function E(M){identifyParams=new n();identifyParams.tolerance=3;identifyParams.returnGeometry=true;identifyParams.layerOption=n.LAYER_OPTION_VISIBLE;identifyParams.width=map.width;identifyParams.height=map.height;identifyParams.geometry=M.mapPoint;identifyParams.mapExtent=map.extent;identifyParams.tolerance=3;identifyParams.SpatialReference=102100;identifyParams.layerIds=[0,1,2,3];var N=fpFEMA_task.execute(identifyParams);N.addCallback(function(O){return dojo.map(O,function(P){var Q=P.feature;if(P.layerName==="Flood Hazard Areas"){Q.setInfoTemplate(flzTemplate)}else{if(P.layerName==="addresspoints"){Q.setInfoTemplate(addrTemplate)}else{if(P.layerName==="Garrett.DBO.TaxParcel"){Q.setInfoTemplate(parcelTemplate)}else{if(P.layerName==="centerlines"){Q.setInfoTemplate(streetTemplate)}}}}return Q},function(P){console.log("Error: "+P)})});map.infoWindow.setFeatures([N]);map.infoWindow.show(M.mapPoint)}map.on("click",E);map.on("click",H);geocoders=[{url:"https://geodata.md.gov/imap/rest/services/GeocodeServices/MD_CompositeLocatorWithEsri/GeocodeServer",name:"MDiMap Composite Locator",singleLineFieldName:"SingleLine"}];geocoder=new D({map:map,geocoders:geocoders,arcgisGeocoder:false},"geosearch");geocoder.startup()});