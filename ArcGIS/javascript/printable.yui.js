var app={};var mpArray;var passedCenter;app.map=null;app.toolbar=null;app.tool=null;app.symbols=null;app.printer=null;require(["esri/map","esri/toolbars/draw","esri/toolbars/edit","esri/dijit/Scalebar","esri/dijit/Print","esri/dijit/Geocoder","esri/dijit/BasemapGallery","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/layers/GraphicsLayer","esri/tasks/PrintTemplate","esri/tasks/LegendLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/renderers/SimpleRenderer","esri/graphic","esri/config","dojo/_base/array","esri/Color","dojo/parser","dojo/query","dojo/dom","dojo/on","dojo/dom-construct","dojo/store/Memory","dijit/registry","dijit/form/CheckBox","dijit/form/ComboBox","dijit/form/Button","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojox/layout/ExpandoPane","dojo/domReady!"],function(y,an,au,i,o,U,ao,aA,g,V,ak,af,ay,Y,ar,u,C,aa,D,L,at,p,aB,Q,h,z,T,P,A,I,ad,q,ac,av,v,l,r){T.parse();Q.defaults.io.proxyUrl="/proxy";var k,ae,O,aj,j,c;var J=false;passedCenter=[passedX,passedY];app.map=new y("map",{basemap:"streets",center:passedCenter,zoom:zoomLevel});function N(){var aH,aG,aL,aK,aI,aE,aJ,aF;aH=document.getElementById("textLatLong").value;aH=aH.replace(/\s+/g,"");aG=aH.indexOf(",");if(aG>0){aL=parseFloat(aH.slice(0,aG));aK=parseFloat(aH.substring(aG+1));aI=new C(C.STYLE_SQUARE,12,new aa(aa.STYLE_SOLID,new z([10,10,10,0.75]),1),new z([255,0,0,0.5]));aE=new g(aK,aL,map.spatialRefernce);aJ=new aB(aE,aI,null,null);app.map.graphics.add(aJ);if(aJ.geometry.type==="point"){aF=app.map.getMaxZoom();app.map.centerAndZoom(aJ.geometry,aF-1)}else{app.map.setExtent(graphicsUtils.graphicsExtent([aJ]))}}else{return""}}function a(aF){var aE=document.getElementById("textLatLong");aE.value=aF.coords.latitude+", "+aF.coords.longitude}function R(){app.map.graphics.clear();var aE=document.getElementById("centroid");if(navigator.geolocation){navigator.geolocation.getCurrentPosition(a)}else{aE.innerHTML="Geolocation is not supported by this browser."}}I(A.byId("getLocationButton"),"click",R);app.map.on("load",function(){app.toolbar=new an(app.map);app.toolbar.on("draw-end",F);app.map.on("mouse-move",am);app.map.on("mouse-drag",am);dojo.connect(app.map,"onExtentChange",x);I(A.byId("submitLatLongButton"),"click",N);ab(app.map)});function az(){app.map.graphics.clear()}function am(aE){var aF=aA.webMercatorToGeographic(aE.mapPoint);A.byId("coordsinfo").innerHTML=aF.y.toFixed(5)+", "+aF.x.toFixed(5);mpArray=[aF.x.toFixed(5),aF.y.toFixed(5)]}function aw(){app.toolbar=new an(app.map);ai("label");app.toolbar.on("draw-end",F);I.once(A.byId("map"),"click",am)}c=new i({map:app.map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});k=new ao({showArcGISBasemaps:true,map:app.map},"basemapGallery");mdImagelayer=new esri.layers.ArcGISTiledMapServiceLayer("https://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/ImageServer");mdImage2011=new esri.layers.ArcGISTiledMapServiceLayer("https://imagery.geodata.md.gov/imap/rest/services/SixInch/SixInchImagery2011_2013/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD 2014 Imagery",thumbnailUrl:"https://maps.garrettcounty.org/arcgis/images/image2014.png"});mdImageBasemap2011=new esri.dijit.Basemap({layers:[mdImage2011],title:"MD 2011 Imagery",thumbnailUrl:"https://maps.garrettcounty.org/arcgis/images/image_v2.png"});k.add(mdImageBasemap);k.add(mdImageBasemap2011);k.startup();k.on("error",function(aE){console.log("basemap gallery error:  ",aE)});ae=new u();ae.layerId="Zoning";O=new u();O.layerId="Protected Species";aj=new u();aj.layerId="Growth Areas";j=new u();j.layerId="Edge of Pavement";legSourceWater=new u();legSourceWater.layerId="Source Water Prot. Areas";var ap,aC,H,E,W,ax,Z,s,b,ag,e,f,t,X;var m=0;function d(){if(m>0){app.printer.destroy()}m+=1;var aF;var aJ=ac.byId("mapTitle");var aE="Data from Garrett County Office of Planning and Land Management. Accuracy is not guaranteed (see https://maps.garrettcounty.org/).";var aG="Title and Graphics created by User at "+ip;aF=aJ.get("value");var aI=[{name:"Letter ANSI A Landscape",label:"Landscape (PDF)",format:"pdf",options:{legendLayers:[ae,O,aj,j,legSourceWater],scalebarUnit:"Miles",titleText:aF+", Landscape PDF",copyrightText:aG,authorText:aE}},{name:"Letter ANSI A Portrait",label:"Portrait (Image)",format:"jpg",options:{legendLayers:[ae,O,aj,j,legSourceWater],scaleBarUnit:"Miles",titleText:aF+", Portrait JPG",copyrightText:aG,authorText:aE}},{name:"Letter ANSI A Landscape",label:"Landscape (Image)",format:"jpg",options:{legendLayers:[ae,O,aj,j,legSourceWater],scaleBarUnit:"Miles",titleText:aF+", Landscape JPG",copyrightText:aG,authorText:aE}},{name:"Letter ANSI A Portrait",label:"Portrait (PDF)",format:"pdf",options:{legendLayers:[ae,O,aj,j,legSourceWater],scaleBarUnit:"Miles",titleText:aF+", Portrait PDF",copyrightText:aG,authorText:aE}}];var aH=h.map(aI,function(aL){var aK=new ar();aK.layout=aL.name;aK.label=aL.label;aK.format=aL.format;aK.layoutOptions=aL.options;return aK});app.printer=new o({map:app.map,templates:aH,url:"https://maps.garrettcounty.org/arcweb/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"},A.byId("printButton"));app.printer.startup()}I(A.byId("prepMap"),"click",d);I(A.byId("clearGraphics"),"click",az);I(A.byId("textLabel"),"click",aw);var w,G,ah,M,aD,al,K;w=new ay();w.layerIds=[1,4,5,6,7];w.layerOption=ay.LAYER_OPTION_SHOW;G=new ay();G.layerIds=[2,7];G.layerOption=ay.LAYER_OPTION_SHOW;K="RDNAMELOCAL";ah=new ay();ah.layerIds=[2,3,4,5,6,7,8,9];ah.layerOption=ay.LAYER_OPTION_SHOW;M=new ay();M.layerIds=[11,12,13,14];M.layerOption=ay.LAYER_OPTION_SHOW;aD=new ay();aD.layerIds=[0,1,2,3,4];aD.layerOption=ay.LAYER_OPTION_SHOW;ap=new ak("https://maps.garrettcounty.org/arcweb/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:G,opacity:0.75,id:"Parcels & Addresses"});aC=new af("https://maps.garrettcounty.org/arcweb/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/3",{mode:af.MODE_ONDEMAND,id:"Cell Towers"});H=new af("https://maps.garrettcounty.org/arcweb/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/1",{mode:af.MODE_ONDEMAND,id:"Wind Turbines"});E=new af("https://maps.garrettcounty.org/arcweb/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/5",{mode:af.MODE_ONDEMAND,outFields:[K],showLabels:true,id:"Street Centerlines"});W=new af("https://maps.garrettcounty.org/arcweb/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/1",{mode:af.MODE_ONDEMAND,id:"Perennial Streams"});ax=new af("https://maps.garrettcounty.org/arcweb/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/11",{mode:af.MODE_ONDEMAND,opacity:0.3,id:"Zoning"});Z=new af("https://maps.garrettcounty.org/arcweb/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/4",{mode:af.MODE_ONDEMAND,opacity:0.45,id:"Source Water Prot. Areas"});s=new af("https://maps.garrettcounty.org/arcweb/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/6",{mode:af.MODE_ONDEMAND,opacity:0.45,id:"Protected Species"});b=new af("https://maps.garrettcounty.org/arcweb/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/7",{mode:af.MODE_ONDEMAND,opacity:0.75,id:"Growth Areas"});ag=new af("https://maps.garrettcounty.org/arcweb/rest/services/FEMA/FEMA/MapServer/2",{mode:af.MODE_ONDEMAND,id:"Flood Hazard",opacity:0.75});e=new af("https://maps.garrettcounty.org/arcweb/rest/services/Contours_and_Plan/Contours_and_Plan/MapServer/0",{mode:af.MODE_ONDEMAND,opacity:0.75,id:"Building Footprints"});f=new ak("https://maps.garrettcounty.org/arcweb/rest/services/Contours_and_Plan/Contours_and_Plan/MapServer",{imageParameters:ah,opacity:0.75,id:"Edge of Pavement"});t=new ak("https://maps.garrettcounty.org/arcweb/rest/services/Contours_and_Plan/Contours_and_Plan/MapServer",{imageParameters:M,opacity:0.75,id:"Contours"});X=new ak("https://maps.garrettcounty.org/arcweb/rest/services/Hydrography/Hydrography/MapServer",{imageParameters:aD,opacity:0.75,id:"Hydrography"});app.map.addLayers([ap,aC,H,E,W,ax,Z,s,b,ag,e,f,t,X]);h.forEach(["Parcels & Addresses","Cell Towers","Wind Turbines","Street Centerlines","Perennial Streams","Zoning","Source Water Prot. Areas","Protected Species","Growth Areas","Flood Hazard","Building Footprints","Edge of Pavement","Hydrography","Contours"],function(aF){new av({id:"cb_"+aF,name:"cb_"+aF,checked:true,onChange:function(aG){aG?app.map.getLayer(this.id.split("_")[1]).show():app.map.getLayer(this.id.split("_")[1]).hide()}},ad.create("input",{id:"lyr_"+aF})).placeAt(A.byId("layerToggle"));var aE=ad.create("label",{"for":"cb_"+aF,innerHTML:aF});ad.place(aE,A.byId("layerToggle"));ad.place(ad.create("br"),A.byId("layerToggle"))});app.symbols={};app.symbols.point=new C("square",10,new aa(),new z([0,255,0,0.75]));app.symbols.polyline=new aa("solid",new z([255,128,0]),2);app.symbols.polygon=new D().setColor(new z([255,255,0,0.25]));app.symbols.circle=new D().setColor(new z([0,0,180,0.25]));app.symbols.line=new aa("solid",new z([180,10,80]),2);P(".drawing").forEach(function(aF){var aE=new l({label:aF.innerHTML,onClick:function(){ai(this.id)}},aF)});var S,n;S=new q({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});n=new v({id:"mapSelect",name:"map",value:"Printable",store:S,searchAttr:"name"},"mapSelect").startup();function aq(){var aF=dijit.byId("mapSelect").get("value"),aG,aE,aH;switch(aF){case"Measurement":aH="_blank";aG="measure.php";break;case"Planning and Zoning":aG="pz_map.php";aH="_blank";break;case"Flood Hazard":aG="FEMA_map.php";aH="_blank";break;case"Sensitive Areas":aG="sensitive.php";aH="_blank";break;case"Printable":aG="printable.php";aH="_self";break}aE=aG+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(aE,aH)}ac.byId("launchButton").on("click",aq);function x(aG){var aF=aA.webMercatorToGeographic(aG.getCenter());passedX=parseFloat(aF.x.toFixed(5));passedY=parseFloat(aF.y.toFixed(5));zoomLevel=app.map.getLevel();var aE=document.getElementById("centroid");aE.innerHTML="Latitude: "+passedY+"<br />Longitude: "+passedX}function ai(aE){if(aE==="label"){app.symbols.point=new C("circle",10,new aa(),new z([255,0,0,0.75]));aE="point";esri.bundle.toolbars.draw.addPoint="Add a text label";J=true}else{if(aE==="point"){app.symbols.point=new C("square",10,new aa(),new z([0,255,0,0.75]));esri.bundle.toolbars.draw.addPoint="Click to add a point";J=false}else{if(aE==="arrow"){app.symbols.arrow=new D().setColor(new z([0,0,180,0.25]))}else{if(aE==="rectangle"){app.symbols.rectangle=new D().setColor(new z([0,180,39,0.25]))}else{J=false}}}}app.tool=aE.replace("freehand","");app.toolbar.activate(aE);app.map.hideZoomSlider()}function ab(){dojo.connect(dijit.byId("map"),"resize",app.map,app.map.resize);au=new esri.toolbars.Edit(app.map);dojo.connect(app.map.graphics,"onClick",function(aE){dojo.stopEvent(aE);B(aE.graphic)});dojo.connect(app.map,"onClick",function(aE){au.deactivate()})}function B(aF){var aE={allowAddVertices:true,allowDeleteVertices:true};au.activate(esri.toolbars.Edit.EDIT_VERTICES|esri.toolbars.Edit.ROTATE,aF,aE)}function F(aF){var aK,aI,aH,aJ,aL,aE;var aG=new at("20px",at.STYLE_NORMAL,at.VARIANT_NORMAL,at.WEIGHT_BOLDER,"Ariel");app.toolbar.deactivate();app.map.showZoomSlider();if(J){aK=prompt("Enter a Text Label","");aH=ac.byId("includeCoords");if(aH.get("checked")){aJ="Lat: "+mpArray[1]+", Long: "+mpArray[0]+"  -  "+aK}else{aJ=aK}aI=new L(aJ,aG,new z([0,0,0]));aL=new aB(aF.geometry,aI);aE=new aB(aF.geometry,app.symbols[app.tool]);app.map.graphics.add(aL);app.map.graphics.add(aE)}else{aL=new aB(aF.geometry,app.symbols[app.tool]);app.map.graphics.add(aL)}J=false}geocoders=[{url:"https://geodata.md.gov/imap/rest/services/GeocodeServices/MD_CompositeLocator/GeocodeServer",name:"MDiMap Composite Locator",singleLineFieldName:"SingleLine"}];geocoder=new U({map:app.map,geocoders:geocoders,arcgisGeocoder:false},"geosearch");geocoder.startup()});