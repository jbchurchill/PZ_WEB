var map,zoom,center,scalebar,checkNull,formatProtectedSpecies,formatFLU,content;var saParameters,mdImageLayer,mdImageBasemap,geocoder,mapLaunchStore,comboBox;var parcelTemplate,addrTemplate,streetTemplate,pstreamTemplate,swpaTemplate,growthAreasTemplate,protectedSpeciesTemplate,SA_fLayer,basemapGallery;var passedCenter,passedX,passedY,zoomLevel;require(["esri/map","esri/dijit/Scalebar","esri/dijit/Popup","esri/dijit/BasemapGallery","dojo/dom","dojo/on","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/Color","esri/graphic","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/InfoTemplate","esri/dijit/Geocoder","dojo/parser","dojo/domReady!"],function(h,s,m,z,c,x,t,o,E,G,e,a,k,l,I,w,p,b,q,J,j,d,i,n,r,B,u){u.parse();var v=new m({fillSymbol:new b(b.STYLE_SOLID,new q(q.STYLE_SOLID,new j([255,0,0]),2),new j([255,255,0,0.25]))},dojo.create("div"));function D(){var L=dijit.byId("mapSelect").get("value"),M,K,N;switch(L){case"Measurement":M="measure.php";N="_blank";break;case"Planning and Zoning":M="pz_map.php";N="_blank";break;case"Flood Hazard":M="FEMA_map.php";N="_blank";break;case"Sensitive Areas":M="sensitive.php";N="_self";break;case"Printable":M="printable.php";N="_blank";break}K=M+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(K,N)}function y(){var L=w.webMercatorToGeographic(map.extent.getCenter());passedX=parseFloat(L.x.toFixed(5));passedY=parseFloat(L.y.toFixed(5));zoomLevel=map.getLevel();var K=document.getElementById("centroid");K.innerHTML="Latitude: "+passedY+"<br />Longitude: "+passedX}function F(){var L,K;L=document.querySelector(".esriPopup");if(L){K=new dojo.dnd.Moveable(c.byId(L))}return K}passedCenter=[passedX,passedY];E.byId("launchButton").on("click",D);function f(){dojo.connect(map,"onExtentChange",y)}map=new h("mapDiv",{basemap:"streets",center:passedCenter,zoom:zoomLevel,infoWindow:v});scalebar=new s({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});function A(){var N,M,R,Q,O,K,P,L;N=document.getElementById("textLatLong").value;N=N.replace(/\s+/g,"");M=N.indexOf(",");if(M>0){R=parseFloat(N.slice(0,M));Q=parseFloat(N.substring(M+1));O=new J(J.STYLE_SQUARE,12,new q(q.STYLE_SOLID,new j([10,10,10,0.75]),1),new j([255,0,0,0.5]));K=new p(Q,R,map.spatialRefernce);P=new d(K,O,null,null);map.graphics.add(P);if(P.geometry.type==="point"){L=map.getMaxZoom();map.centerAndZoom(P.geometry,L-1)}else{map.setExtent(graphicsUtils.graphicsExtent([P]))}}else{return""}}function H(L){var K=document.getElementById("textLatLong");K.value=L.coords.latitude+", "+L.coords.longitude}function g(){map.graphics.clear();var K=document.getElementById("centroid");if(navigator.geolocation){navigator.geolocation.getCurrentPosition(H)}else{K.innerHTML="Geolocation is not supported by this browser."}}x(c.byId("getLocationButton"),"click",g);map.on("load",f);x(c.byId("submitLatLongButton"),"click",A);mapLaunchStore=new t({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});comboBox=new o({id:"mapSelect",name:"map",value:"Sensitive Areas",store:mapLaunchStore,searchAttr:"name"},"mapSelect").startup();checkNull=function(L,K){function M(O,P,N){if(O==""|O=="Null"){content=""}else{if(N){if(P=='SDAT Link: <a href="'){O+='" target="_blank">LINK</a>'}O+="<br />"}content=P+O}}switch(K){case"SUBDIVSN":M(L,"Subdivision: ",true);break;case"PLAT":M(L,"Plat: ",true);break;case"BLOCK":M(L,"Block: ",true);break;case"PLTLIBER":M(L,'<hr><span class="sectionhead">Plat Reference</span><br />Liber: ',true);break;case"PLTFOLIO":M(L,"Folio: ",true);break;case"OWNNAME2":M(L," ",false);break;case"SDATWEBADR":M(L,'SDAT Link: <a href="',true);break;case"DR1LIBER":M(L,'<hr><span class="sectionhead">Deed Reference</span><br />Liber: ',true);break;case"DR1FOLIO":M(L,"Folio: ",true);break;case"CITY":M(L,"City: ",true);break}return content};formatProtectedSpecies=function(L,K){if(K=="GROUP"&&L=="Null"){content=""}else{if(K=="GROUP"&&L=="GROUP 1"){content="Type: Federally Protected Species"}else{if(K=="GROUP"&&L=="GROUP 2"){content="Type: State Protected Species"}}}return content};formatFLU=function(L,K){if(K=="FLU"&&L=="Null"){content=""}else{if(K=="FLU"&&L=="A"){content=L+" &#045; Permitted Accessory Use"}else{if(K=="FLU"&&L=="AR"){content=L+" &#045; Agricultural Resource"}else{if(K=="FLU"&&L=="C"){content=L+" &#045; General Commercial"}else{if(K=="FLU"&&L=="CR1"){content=L+" &#045; Commercial Resort 1"}else{if(K=="FLU"&&L=="CR2"){content=L+" &#045; Commercial Resort 2"}else{if(K=="FLU"&&L=="LR1"){content=L+" &#045; Lake Residential 1"}else{if(K=="FLU"&&L=="LR2"){content=L+" &#045; Lake Residential 2"}else{if(K=="FLU"&&L=="N"){content=L+" &#045; Not Permitted"}else{if(K=="FLU"&&L=="P"){content=L+" &#045; Permitted by Right Use"}else{if(K=="FLU"&&L=="RR"){content=L+" &#045; Rural Resource"}else{if(K=="FLU"&&L=="SE"){content=L+" &#045; Special Exception"}else{if(K=="FLU"&&L=="TC"){content=L+" &#045; Town Center"}else{if(K=="FLU"&&L=="TR"){content=L+" &#045; Town Residential"}else{if(K=="FLU"&&L=="EC"){content=L+" &#045; Employment Center"}else{if(K=="FLU"&&L=="GC"){content=L+" &#045; General Commercial"}else{if(K=="FLU"&&L=="SR"){content=L+" &#045; Suburban Residential"}}}}}}}}}}}}}}}}}return content};parcelTemplate=new r("Parcel Info",'<span class="sectionhead">Layer: Parcels</span><br /><br /><hr>Address: ${ADDRESS} <br />${CITY:checkNull} Owner: ${OWNNAME1} ${OWNNAME2:checkNull} <br /> Tax Id: ${ACCTID} <br />${DR1LIBER:checkNull} ${DR1FOLIO:checkNull} <hr> ${SUBDIVSN:checkNull} ${PLAT:checkNull} ${BLOCK:checkNull} Grid: ${GRID} <br />Map: ${MAP} <br /> Parcel: ${PARCEL} <br /> Lot: ${LOT} <br /> Area: ${ACRES} Acres <br />${PLTLIBER:checkNull} ${PLTFOLIO:checkNull} <hr>Year Built: ${YRBLT_CAMA} <br /> ${SDATWEBADR:checkNull}');addrTemplate=new r("Address Info",'<span class="sectionhead">Layer: Address Points</span><br /><br /><hr>Address: ${ADDRESS} <br /><br /> City: ${CITY} <br /> Zip: ${ZIP_CODE} <br /> ESN: ${ESN} <br /> Community: ${COMMUNITY} <br /> Map: ${MAP} <br /> Parcel: ${PARCEL} <br />Lot: ${LOT} <br /> Tract: ${TRACT} <br /> LU: ${LU} <br /> Key date: ${KEYDATE} <br /> Rental: ${RENTAL} <br />Rental Co.: ${RENTAL_CO} <br /> Tax Account: ${TAX_ACCOUNT_ID} <br /> Owner: ${OWNER_FIRST_NAME} ${OWNER_LAST_NAME} <br />');streetTemplate=new r("Street Info",'<span class="sectionhead">Layer: Street Centerlines</span><br /><br /><hr>Name: ${STREET_ALL} <br />Maintenance: ${MAINTENANCE} <br /> Length: ${SHAPE.len:NumberFormat(places:1)} feet <br />');pstreamTemplate=new r("Stream Info",'<span class="sectionhead">Layer: Perennial Streams</span><br /><br /><hr>Stream Segment Length: ${SHAPE_Leng:NumberFormat(places:1)} feet');swpaTemplate=new r("Source Water Info",'<span class="sectionhead">Layer: Source Water Protection Areas</span><br /><br />Water System: ${WHPAs_Me_2} <br /> Geology: ${WHPAs_Me_6} <br /> Project Info: ${WHPAs_M_11} <br /> Location: ${WHPAs_M_12} <br />Source: ${CWS_SRC_NA} <br /> Completion Date: ${CWS_COMP_D} <br /> Aquifer: ${CWS_AQUIFE} <br />');growthAreasTemplate=new r("Growth Areas Info",'<span class="sectionhead">Layer: Growth Areas</span><br /><br />Land Use: ${GENZONE} <br /> Acreage: ${ACRES:NumberFormat(places:2)} <br /> Zoning: ${FLU:formatFLU}');protectedSpeciesTemplate=new r("Protected Species Info",'<span class="sectionhead">Layer: Protected Species</span><br /><br /><hr>${GROUP:formatProtectedSpecies}');dclTemplate=new r("Deep Creek Lake",'<span class="sectionhead">Layer: Deep Creek Lake</span><br /><br /><hr>Estimated Acreage: ${Acreage:NumberFormat(places:0)}');saParameters=new I();saParameters.layerIds=[0,1,2,3,4,5,6,7];saParameters.layerOption=I.LAYER_OPTION_SHOW;SA_fLayer=new k("https://maps.garrettcounty.org/arcweb/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer",{imageParameters:saParameters,opacity:0.75});map.addLayer(SA_fLayer);basemapGallery=new z({showArcGISBasemaps:true,map:map},"basemapGallery");mdImagelayer=new esri.layers.ArcGISTiledMapServiceLayer("https://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/ImageServer");mdImage2011=new esri.layers.ArcGISTiledMapServiceLayer("https://imagery.geodata.md.gov/imap/rest/services/SixInch/SixInchImagery2011_2013/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD 2014 Imagery",thumbnailUrl:"https://maps.garrettcounty.org/arcgis/images/image2014.png"});mdImageBasemap2011=new esri.dijit.Basemap({layers:[mdImage2011],title:"MD 2011 Imagery",thumbnailUrl:"https://maps.garrettcounty.org/arcgis/images/image_v2.png"});basemapGallery.add(mdImageBasemap);basemapGallery.add(mdImageBasemap2011);basemapGallery.startup();basemapGallery.on("error",function(K){console.log("basemap gallery error:  ",K)});function C(L){var O,N,K,M=new i("https://maps.garrettcounty.org/arcweb/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer");N=[0,1,2,3,4,5,6,7];K=new n();K.tolerance=3;K.returnGeometry=true;K.layerOption=n.LAYER_OPTION_VISIBLE;K.layerIds=N;K.width=map.width;K.height=map.height;K.geometry=L.mapPoint;K.mapExtent=map.extent;K.tolerance=3;K.SpatialReference=102100;O=M.execute(K);O.addCallback(function(P){return dojo.map(P,function(Q){var R=Q.feature;if(Q.layerName==="addresspoints"){R.setInfoTemplate(addrTemplate)}else{if(Q.layerName==="Parcels"){R.setInfoTemplate(parcelTemplate)}else{if(Q.layerName==="centerlines"){R.setInfoTemplate(streetTemplate)}else{if(Q.layerName==="GrowthAreas"){R.setInfoTemplate(growthAreasTemplate)}else{if(Q.layerName==="Source Water Protection Areas"){R.setInfoTemplate(swpaTemplate)}else{if(Q.layerName==="Protected Species"){R.setInfoTemplate(protectedSpeciesTemplate)}else{if(Q.layerName==="Perennial Streams"){R.setInfoTemplate(pstreamTemplate)}else{if(Q.layerName==="Deep Creek Lake"){R.setInfoTemplate(dclTemplate)}}}}}}}}return R},function(Q){console.log("Error: "+Q)})});map.infoWindow.show(L.mapPoint);map.infoWindow.setFeatures([O])}map.on("click",C);map.on("click",F);geocoders=[{url:"https://geodata.md.gov/imap/rest/services/GeocodeServices/MD_CompositeLocatorWithEsri/GeocodeServer",name:"MDiMap Composite Locator",singleLineFieldName:"SingleLine"}];geocoder=new B({map:map,geocoders:geocoders,arcgisGeocoder:false},"geosearch");geocoder.startup()});