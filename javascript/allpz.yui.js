var findTask,findParams;var dojo,getExtent,require,doFind,esri,document,dijit,console,window;var map,center,zoom;var grid,store;var identifyTask,identifyParams;var addlIdArray=[];var xMin,yMin,xMax,yMax;var extArray=[];var passedCenter,passedX,passedY,zoomLevel;function startTrackingExtent(){dojo.connect(map,"onExtentChange",getExtent)}function contains(b,d){var c;for(c=0;c<b.length;c++){if(b[c]===d){return true}}return false}function executeIdentifyTask(a){var c;identifyParams.geometry=a.mapPoint;identifyParams.mapExtent=map.extent;identifyParams.layerIds=[1,4,5,6,8];for(c=0;c<addlIdArray.length;c++){identifyParams.layerIds.push(addlIdArray[c].value)}var d=identifyParams.layerIds;d.sort(function(f,e){return f-e});var b=identifyTask.execute(identifyParams);checkNull=function(h,e,g){var f;function i(k,l,j){if(k=="Null"){f=""}else{if(j){if(l=='SDAT Link: <a href="'){k+='" target="_blank">LINK</a>'}k+="<br />"}f=l+k}}switch(e){case"SOURCE_OF_DATA":i(h,"Source of Data: ",true);break;case"TOWER_HEIGHT":i(h,"Tower Height: ",false);break;case"HEIGHT_ELEV_UNITS":i(h,", ",true);break;case"TOWER_COMMUNITY":i(h,"Community: ",true);break;case"GROUND_ELEV":i(h,"Ground Elevation: ",false);break;case"SUBDIVSN":i(h,"Subdivision: ",true);break;case"PLAT":i(h,"Plat: ",true);break;case"BLOCK":i(h,"Block: ",true);break;case"PLTLIBER":i(h,'<hr><span class="sectionhead">Plat Reference</span><br />Liber: ',true);break;case"PLTFOLIO":i(h,"Folio: ",true);break;case"OWNNAME2":i(h," ",false);break;case"SDAT_URL":i(h,'SDAT Link: <a href="',true);break}return f};b.addCallback(function(e){var f;return dojo.map(e,function(g){var h=g.feature;h.attributes.layerName=g.layerName;if(g.layerName==="addresspoints"){f=new esri.InfoTemplate("Address Info",'<span class="sectionhead">Layer: Address Points</span><br /><br /><hr>Address: ${ADDRESS} <br /><br /> City: ${CITY} <br /> Zip: ${ZIP_CODE} <br /> ESN: ${ESN} <br /> Community: ${COMMUNITY} <br /> Map: ${MAP} <br /> Parcel: ${PARCEL} <br />Lot: ${LOT} <br /> Tract: ${TRACT} <br /> LU: ${LU} <br /> Key date: ${KEYDATE} <br /> Rental: ${RENTAL} <br />Rental Co.: ${RENTAL_CO} <br /> Tax Account: ${TAX_ACCOUNT_ID} <br /> Owner: ${OWNER_FIRST_NAME} ${OWNER_LAST_NAME} <br />');h.setInfoTemplate(f)}else{if(g.layerName==="Critical_Facilities"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Critical Facilities </span><br /><br /><hr>Land Use: ${LU} <br /> Address: ${ADDRESS} ${ROADNAME} <br /> Last Name: ${LASTNAME} <br /> ');h.setInfoTemplate(f)}else{if(g.layerName==="Gas_Wells"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Gas Wells</span><br /><br /><hr>Well Number: ${OBJECTID} <br />');h.setInfoTemplate(f)}else{if(g.layerName==="celltowers"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Cell Towers</span><br /><br /><hr>Address: ${TOWER_ADDRESS} <br /> ${TOWER_COMMUNITY:checkNull} ${GROUND_ELEV:checkNull} ${HEIGHT_ELEV_UNITS:checkNull} ${TOWER_HEIGHT:checkNull} ${HEIGHT_ELEV_UNITS:checkNull}Comments: ${COMMENTS} <br /> ${SOURCE_OF_DATA:checkNull}');h.setInfoTemplate(f)}else{if(g.layerName==="centerlines"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Street Centerlines</span><br /><br /><hr>Name: ${STREET_ALL} <br />Maintenance: ${MAINTENANCE} <br /> Length: ${SHAPE.len:NumberFormat} feet <br />');h.setInfoTemplate(f)}else{if(g.layerName==="Election_Districts"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Election Districts</span><br /><br /><hr>Election District: ${Dist_Numb} <br /> Commissioner District: ${Comm_Dist} <br />');h.setInfoTemplate(f)}else{if(g.layerName==="Zip Codes"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Zip Codes</span><br /><br /><hr>Zip Code: ${ZIPNAME} <br />Zip Code: ${ZIPCODE1} <br />');h.setInfoTemplate(f)}else{if(g.layerName==="Wind_Turbines"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Wind Turbines</span><br /><br /><hr>Identifier: ${Identifier} <br />Owner: ${Owner} <br />');h.setInfoTemplate(f)}else{if(g.layerName==="County_Zoning_Layer"){f=new esri.InfoTemplate("Zoning Info",'<span class="sectionhead">Layer: County Zoning Layer </span><br /><br /><hr>${GENZONE} <br/> Land Use Code: ${FLU}');h.setInfoTemplate(f)}else{if(g.layerName==="Tax Map Grid"){f=new esri.InfoTemplate("Tax Map Info",'<span class="sectionhead">Layer: Tax Map Grid </span><br /><br /><hr>Map ID: ${MAPID} <br />Tax Map: ${TAXMAP}');h.setInfoTemplate(f)}else{if(g.layerName==="Garrett.DBO.TaxParcel"){f=new esri.InfoTemplate("",'<span class="sectionhead">Layer: Parcels</span><br /><br /><hr>Address: ${ADDRESS} <br />City: ${CITY} <br /> Owner: ${OWNNAME1} ${OWNNAME2:checkNull} <br /> Tax Id: ${ACCTID} <br /><hr><span class="sectionhead">Deed Reference</span><br />Liber: ${DR1LIBER} <br /> Folio: ${DR1FOLIO} <br /><hr> ${SUBDIVSN:checkNull} ${PLAT:checkNull} ${BLOCK:checkNull} Grid: ${GRID} <br />Map: ${MAP} <br /> Parcel: ${PARCEL} <br /> Lot: ${LOT} <br /> Area: ${ACRES} Acres <br />${PLTLIBER:checkNull} ${PLTFOLIO:checkNull} <hr>Year Built: ${YRBLT_CAMA} <br /> ${SDAT_URL:checkNull}');map.infoWindow.resize(250,500);h.setInfoTemplate(f)}}}}}}}}}}}return h})});map.infoWindow.setFeatures([b]);map.infoWindow.show(a.mapPoint)}require(["esri/map","esri/dijit/Scalebar","esri/dijit/BasemapGallery","esri/dijit/Popup","esri/geometry/webMercatorUtils","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters","esri/tasks/query","esri/toolbars/draw","esri/tasks/IdentifyTask","esri/tasks/FindTask","esri/tasks/FindParameters","esri/layers/FeatureLayer","esri/tasks/IdentifyResult","esri/tasks/IdentifyParameters","esri/dijit/InfoWindow","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/InfoTemplate","dojo/_base/array","dojo/_base/connect","dojox/grid/DataGrid","dojox/layout/ExpandoPane","dojo/data/ItemFileReadStore","esri/Color","dojo/on","dojo/dom","dojo/query","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dojo/parser","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/layout/AccordionContainer","dijit/TitlePane","dijit/form/Button","dijit/form/RadioButton","esri/dijit/Geocoder","dojo/domReady!"],function(l,x,Y,r,I,o,ap,N,ac,m,W,af,ab,Z,s,E,d,v,w,D,t,y,z,F,n,J,f,an,A,u,ak,G,am,i,Q,c,ae,al,ad){G.parse();var ao,H,a,h,g,j,C,O,T,aa;ao=1;ak.byId("search").on("click",ag);ak.byId("search2").on("click",ag);passedCenter=[passedX,passedY];H=new r({fillSymbol:new d(d.STYLE_SOLID,new v(v.STYLE_SOLID,new n([255,0,0]),2),new n([255,255,0,0.25]))},dojo.create("div"));map=new l("mapDiv",{basemap:"streets",center:passedCenter,zoom:zoomLevel,infoWindow:H});findTask=new W("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer");map.on("load",function(){findParams=new af();findParams.returnGeometry=true;findParams.layerIds=[6,8];findParams.searchFields=["RDNAMELOCAL","PARCEL"];findParams.outSpatialReference=map.spatialReference;console.log("find sr: ",findParams.outSpatialReference)});a=new x({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});h=new Y({showArcGISBasemaps:true,map:map},"basemapGallery");g=new esri.layers.ArcGISTiledMapServiceLayer("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");j=new esri.dijit.Basemap({layers:[g],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});h.add(j);h.startup();h.on("error",function(aq){console.log("basemap gallery error:  ",aq)});C=new ap();C.layerIds=[1,4,5,6,8];C.layerOption=ap.LAYER_OPTION_SHOW;O=[];T=new o("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:C,opacity:0.55});map.addLayer(T);function S(at){var au,ar,aq;au=0;ar=[];aq="";D.forEach(at.features,function(av){aq+=av.attributes.ADDRESS+"<br />";ar.push(av.attributes.ADDRESS);au+=1});f.byId("messages").innerHTML="<strong>Number of Selected Points: "+au+"</strong><br />"+aq}function X(at){var au,ar,aq;au=0;ar=[];aq="";D.forEach(at.features,function(av){aq+="<strong>MAP: </strong>"+av.attributes.MAP+"<br /><strong>PARCEL: </strong>"+av.attributes.PARCEL+'<br /><strong>LINK: </strong><a href="'+av.attributes.SDAT_URL+'" target="_blank">Link</a><br /><hr />';ar.push(av.attributes.MAP);au+=1});f.byId("messages").innerHTML="<strong>Number of Selected Parcels: "+au+"</strong><br />"+aq}var P,k,M,e,b=false;function R(){if(b){P=new d(d.STYLE_SOLID,new v(v.STYLE_DASHDOT,new n([255,0,0]),2),new n([255,255,0,0.5]));k="Map: ${MAP}<br />Parcel: ${PARCEL}<br />Lot: ${LOT}<br />Grid: ${GRID}<br />Tax ID: ${ACCTID}<br /><hr>";M=new w("${FIELD_NAME}",k);e=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/8",{mode:ab.MODE_ONDEMAND,outFields:["*"]});e.on("selection-complete",X)}else{P=new esri.symbol.SimpleMarkerSymbol().setColor(new dojo.Color([0,255,255]));P.setSize(9);k="Address: ${ADDRESS}<br />City: ${CITY} <br /> Owner: ${OWNNAME1} ${OWNNAME2} <br /> Tax Id: ${ACCTID} <br /><hr>";M=new w("${FIELD_NAME}",k);e=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/4",{mode:ab.MODE_ONDEMAND,outFields:["*"]});e.on("selection-complete",S)}e.setSelectionSymbol(P);e.on("selection-clear",function(){f.byId("messages").innerHTML="<i>No Selected Point or Parcels</i>"});map.addLayer(e)}J(f.byId("polys"),"click",function(){b=true;e.clearSelection();R()});J(f.byId("points"),"click",function(){b=false;e.clearSelection();R()});J(f.byId("selectPointsButton"),"click",function(){var aq;aq=document.getElementById("rectangle").checked;if(aq){aa.activate(ac.EXTENT)}else{aa.activate(ac.FREEHAND_POLYGON)}});J(f.byId("clearSelectionButton"),"click",function(){e.clearSelection();map.graphics.clear();ao=0;U("")});var q,aj;q=new A({data:[{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"FEMA Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"}]});aj=new u({id:"mapSelect",name:"map",value:"Measurement",store:q,searchAttr:"name"},"mapSelect").startup();function ah(){var ar,at,aq;ar=dijit.byId("mapSelect").get("value");switch(ar){case"Measurement":at="measure.php";break;case"FEMA Flood Hazard":at="FEMA_map.php";break}aq=at+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(aq,"_blank")}ak.byId("launchButton").on("click",ah);function L(ar){var aq=I.webMercatorToGeographic(ar.getCenter());passedX=parseFloat(aq.x.toFixed(5));passedY=parseFloat(aq.y.toFixed(5));zoomLevel=map.getLevel()}function B(ar){var aq;R();dojo.connect(map,"onExtentChange",L);aa=new ac(ar.map);aq=new N();J(aa,"DrawEnd",function(at){aa.deactivate();aq.geometry=at;e.selectFeatures(aq,ab.SELECTION_NEW)})}map.on("load",B);map.on("click",executeIdentifyTask);identifyTask=new m("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer");identifyParams=new s();identifyParams.tolerance=3;identifyParams.returnGeometry=true;identifyParams.layerOption=s.LAYER_OPTION_ALL;identifyParams.width=map.width;identifyParams.height=map.height;var V;function ag(){if(this.id=="search"){findParams.searchText=f.byId("roadName").value;V="grid"}else{if(this.id=="search2"){findParams.searchText=f.byId("parcelInfo").value;V="grid1"}}findTask.execute(findParams,U)}function U(au){map.graphics.clear();var aw=new v(v.STYLE_SOLID,new n([98,194,204]),3);var ar=D.map(au,function(ax){var ay=ax.feature;ay.setSymbol(aw);map.graphics.add(ay);return ax.feature.attributes});if(V=="grid"){var av={identifier:"OBJECTID",label:"OBJECTID",items:ar}}else{if(V=="grid1"){var av={identifier:"ACCTID",label:"ACCTID",items:ar}}}var aq=new F({data:av});var at=ak.byId(V);if(!(V=="")){at.setStore(aq);at.on("rowclick",ai)}if(ao==1){map.centerAndZoom(center,zoom)}ao=1}function ai(ar){var at,aq;if(V=="grid"){at=ar.grid.getItem(ar.rowIndex).OBJECTID;aq=D.filter(map.graphics.graphics,function(au){return((au.attributes)&&au.attributes.OBJECTID===at)})}else{if(V=="grid1"){at=ar.grid.getItem(ar.rowIndex).ACCTID;aq=D.filter(map.graphics.graphics,function(au){return((au.attributes)&&au.attributes.ACCTID===at)})}}if(aq.length){map.setExtent(aq[0].geometry.getExtent(),true)}}J(f.byId("layer10CheckBox"),"change",K);J(f.byId("layer2CheckBox"),"change",K);J(f.byId("layer3CheckBox"),"change",K);J(f.byId("layer7CheckBox"),"change",K);J(f.byId("layer9CheckBox"),"change",K);J(f.byId("layer11CheckBox"),"change",K);function K(){var ar;var aq=an(".list_item");var at=aq.length;O=[1,4,5,6,8];addlIdArray=[];for(ar=0;ar<at;ar++){if(aq[ar].checked){O.push(aq[ar].value);if(!(contains(addlIdArray,aq[ar].value))){addlIdArray.push(aq[ar])}}}if(O.length===0){O.push(-1)}if(addlIdArray.length===0){addlIdArray.push(-1)}T.setVisibleLayers(O)}var p=new ad({map:map},"geosearch");p.startup()});