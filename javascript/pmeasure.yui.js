var map,console,require;var passedCenter,passedX,passedY,zoomLevel;require(["dojo/dom","esri/Color","dojo/keys","dojo/parser","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters","esri/dijit/BasemapGallery","esri/config","esri/sniff","esri/map","esri/tasks/GeometryService","esri/dijit/Scalebar","esri/dijit/Basemap","esri/SnappingManager","esri/dijit/Measurement","esri/geometry/webMercatorUtils","esri/layers/FeatureLayer","esri/renderers/SimpleRenderer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","esri/dijit/Geocoder","dojo/domReady!"],function(f,p,C,E,q,w,S,I,v,h,o,Q,A,H,L,u,F,J,y,z,d,B,x,O,R,j,c,K){E.parse();var i,a,g,m,l,D,b,P,e,n,t,r;var s,N;v.defaults.io.proxyUrl="/proxy";v.defaults.io.alwaysUseProxy=false;v.defaults.geometryService=new Q("http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");function M(){var U=dijit.byId("mapSelect").get("value"),V,T,W;switch(U){case"Measurement":W="_self";V="measure.php";break;case"Planning and Zoning":V="pz_map.php";W="_blank";break;case"Flood Hazard":V="FEMA_map.php";W="_blank";break;case"Sensitive Areas":V="sensitive.php";W="_blank";break;case"Printable":V="printable.php";W="_blank";break}var T=V+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(T,W)}passedCenter=[passedX,passedY];O.byId("launchButton").on("click",M);function k(){dojo.connect(map,"onExtentChange",G)}map=new o("map",{basemap:"streets",center:passedCenter,zoom:zoomLevel});i=new I({showArcGISBasemaps:true,map:map},"basemapGallery");a=new A({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});map.on("load",k);var s=new B({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});var N=new x({id:"mapSelect",name:"map",value:"Measurement",store:s,searchAttr:"name"},"mapSelect").startup();function G(U){var T=F.webMercatorToGeographic(map.extent.getCenter());passedX=parseFloat(T.x.toFixed(5));passedY=parseFloat(T.y.toFixed(5));zoomLevel=map.getLevel();console.log("Zoom: "+zoomLevel+";  XY: "+passedX+", "+passedY)}g=new esri.layers.ArcGISTiledMapServiceLayer("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");m=new esri.dijit.Basemap({layers:[g],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});i.add(m);i.startup();i.on("error",function(T){console.log("basemap gallery error:  ",T)});l=new d("solid",new z("solid",new p([195,176,23]),2),null);D=new S();D.layerIds=[1,4,5,6,8];D.layerOption=S.LAYER_OPTION_SHOW;b=new q("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:D,opacity:0.55});map.addLayer(b);P=new J("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/8",{mode:J.MODE_ONDEMAND,outFields:["*"]});P.setRenderer(new y(l));map.addLayers([P]);e=map.enableSnapping({snapKey:h("mac")?C.META:C.CTRL});n=[{layer:P}];e.setLayerInfos(n);t=new u({map:map},f.byId("measurementDiv"));t.startup();r=new K({map:map},"geosearch");r.startup()});