var map,console,require,dojo,dijit;var passedCenter,passedX,passedY,zoomLevel,bMap,bMapName,myBaseMap,twlBaseMap;require(["dojo/dom","esri/Color","dojo/keys","dojo/parser","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters","esri/dijit/BasemapGallery","esri/dijit/BasemapLayer","esri/config","esri/sniff","esri/map","esri/tasks/GeometryService","esri/dijit/Scalebar","esri/dijit/Basemap","esri/SnappingManager","esri/dijit/Measurement","esri/geometry/webMercatorUtils","esri/layers/FeatureLayer","esri/renderers/SimpleRenderer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","esri/dijit/Geocoder","dojo/domReady!"],function(f,q,D,F,r,x,T,J,p,w,h,o,R,B,I,M,v,G,K,z,A,d,C,y,P,S,j,c,L){F.parse();var i,b,g,m,l,E,a,Q,e,n,u,s;var t,O;w.defaults.io.proxyUrl="/proxy";w.defaults.io.alwaysUseProxy=false;w.defaults.geometryService=new R("http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");function N(){var V=dijit.byId("mapSelect").get("value"),W,U,X;switch(V){case"Measurement":X="_self";W="measure.php";break;case"Planning and Zoning":W="pz_map.php";X="_blank";break;case"Flood Hazard":W="FEMA_map.php";X="_blank";break;case"Sensitive Areas":W="sensitive.php";X="_blank";break}U=W+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel+"&bMap="+bMap;window.open(U,X)}switch(bMap){case"basemap_0":bMapName="MD Imagery";break;case"basemap_1":bMapName="osm";break;case"basemap_2":bMapName="oceans";break;case"basemap_3":bMapName="national-geographic";break;case"basemap_4":bMapName="gray";break;case"basemap_5":bMapName="terrain";break;case"basemap_6":bMapName="topo";break;case"basemap_7":bMapName="streets";break;case"basemap_8":bMapName="hybrid";break;case"basemap_9":bMapName="satellite";break;default:bMapName="streets";bMap="basemap_7";break}passedCenter=[passedX,passedY];P.byId("launchButton").on("click",N);g=new x("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");if(bMapName==="terrain"){map=new o("map",{basemap:new I({id:"terrain",layers:[new p({url:"http://services.arcgisonline.com/arcgis/rest/services/World_Terrain_Base/MapServer"}),new p({url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer"})]}),center:passedCenter,zoom:zoomLevel})}else{if(bMapName==="MD Imagery"){map=new o("map",{basemap:new I({id:"MD Imagery",layers:[g]}),center:passedCenter,zoom:zoomLevel})}else{map=new o("map",{basemap:bMapName,center:passedCenter,zoom:zoomLevel})}}console.log("Current bMap: "+bMap);i=new J({showArcGISBasemaps:true,map:map},"basemapGallery");i.on("selection-change",function(){myBaseMap=i.getSelected();bMap=myBaseMap.id});function H(){var U=G.webMercatorToGeographic(map.extent.getCenter());passedX=parseFloat(U.x.toFixed(5));passedY=parseFloat(U.y.toFixed(5));zoomLevel=map.getLevel();console.log("Zoom: "+zoomLevel+";  XY: "+passedX+", "+passedY+", "+bMap)}function k(){dojo.connect(map,"onExtentChange",H)}b=new B({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});map.on("load",k);t=new C({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"}]});O=new y({id:"mapSelect",name:"map",value:"Measurement",store:t,searchAttr:"name"},"mapSelect").startup();m=new I({layers:[g],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});i.add(m);i.startup();i.on("error",function(U){console.log("basemap gallery error:  ",U)});l=new d("solid",new A("solid",new q([145,105,135]),2),null);E=new T();E.layerIds=[1,4,5,6,8];E.layerOption=T.LAYER_OPTION_SHOW;a=new r("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:E,opacity:0.55});map.addLayer(a);Q=new K("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/8",{mode:K.MODE_ONDEMAND,outFields:["*"]});Q.setRenderer(new z(l));map.addLayers([Q]);e=map.enableSnapping({snapKey:h("mac")?D.META:D.CTRL});n=[{layer:Q}];e.setLayerInfos(n);u=new v({map:map},f.byId("measurementDiv"));u.startup();s=new L({map:map},"geosearch");s.startup()});