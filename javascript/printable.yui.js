var app={};var mpArray;var passedCenter;app.map=null;app.toolbar=null;app.tool=null;app.symbols=null;app.printer=null;require(["esri/map","esri/toolbars/draw","esri/dijit/Print","esri/dijit/Geocoder","esri/dijit/Legend","esri/dijit/BasemapGallery","esri/geometry/webMercatorUtils","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/layers/LabelLayer","esri/tasks/PrintTemplate","esri/tasks/LegendLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/renderers/SimpleRenderer","esri/graphic","esri/config","dojo/_base/array","esri/Color","dojo/parser","dojo/query","dojo/dom","dojo/on","dojo/dom-construct","dojo/store/Memory","dijit/registry","dijit/form/CheckBox","dijit/form/ComboBox","dijit/form/Button","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojox/layout/ExpandoPane","dojo/domReady!"],function(r,Y,Q,aa,p,W,N,D,x,X,am,P,o,T,an,I,b,ak,V,H,f,B,e,w,M,al,c,O,Z,K,ai,z,G,ab,J){M.parse();B.defaults.io.proxyUrl="/proxy";var g;var j=false;passedCenter=[passedX,passedY];app.map=new r("map",{basemap:"streets",center:passedCenter,zoom:zoomLevel});app.map.on("load",function(){app.toolbar=new Y(app.map);app.toolbar.on("draw-end",t);app.map.on("mouse-move",i);app.map.on("mouse-drag",i);dojo.connect(app.map,"onExtentChange",R)});function a(){app.map.graphics.clear()}function i(ao){var ap=N.webMercatorToGeographic(ao.mapPoint);c.byId("coordsinfo").innerHTML=ap.x.toFixed(5)+", "+ap.y.toFixed(5);mpArray=[ap.x.toFixed(5),ap.y.toFixed(5)]}function h(){app.toolbar=new Y(app.map);u("label");app.toolbar.on("draw-end",t);O.once(c.byId("map"),"click",i)}g=new W({showArcGISBasemaps:true,map:app.map},"basemapGallery");mdImagelayer=new esri.layers.ArcGISTiledMapServiceLayer("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});g.add(mdImageBasemap);g.startup();g.on("error",function(ao){console.log("basemap gallery error:  ",ao)});var S=new T();S.layerId="Zoning";var af,ad,E,m,v,k,C,n,d,l;var aj=0;function U(){if(aj>0){return}aj+=1;var ap;var au=ai.byId("mapTitle");var ao="Data from Garrett County Office of Planning and Land Management. Accuracy is not guaranteed (see http://gis.garrettcounty.org/).";var aq="Title and Graphics created by User at "+ip;ap=au.get("value");var at=[{name:"Letter ANSI A Landscape",label:"Landscape (PDF)",format:"pdf",options:{legendLayers:[S],scalebarUnit:"Miles",titleText:ap+", Landscape PDF",copyrightText:aq,authorText:ao}},{name:"Letter ANSI A Portrait",label:"Portrait (Image)",format:"jpg",options:{legendLayers:[S],scaleBarUnit:"Miles",titleText:ap+", Portrait JPG",copyrightText:aq,authorText:ao}},{name:"Letter ANSI A Landscape",label:"Landscape (Image)",format:"jpg",options:{legendLayers:[S],scaleBarUnit:"Miles",titleText:ap+", Landscape JPG",copyrightText:aq,authorText:ao}},{name:"Letter ANSI A Portrait",label:"Portrait (PDF)",format:"pdf",options:{legendLayers:[S],scaleBarUnit:"Miles",titleText:ap+", Portrait PDF",copyrightText:aq,authorText:ao}}];var ar=e.map(at,function(aw){var av=new o();av.layout=aw.name;av.label=aw.label;av.format=aw.format;av.layoutOptions=aw.options;return av});app.printer=new Q({map:app.map,templates:ar,url:"http://gis.garrettcounty.org:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"},c.byId("printButton"));app.printer.startup()}O(c.byId("prepMap"),"click",U);O(c.byId("clearGraphics"),"click",a);O(c.byId("textLabel"),"click",h);var L,ac,s,F,ag,q;L=new am();L.layerIds=[1,4,5,6,7];L.layerOption=am.LAYER_OPTION_SHOW;ac=new am();ac.layerIds=[4,8];ac.layerOption=am.LAYER_OPTION_SHOW;F="RDNAMELOCAL";af=new x("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:ac,opacity:0.75,id:"Parcels & Addresses"});ad=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/5",{mode:X.MODE_ONDEMAND,id:"Cell Towers"});E=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/3",{mode:X.MODE_ONDEMAND,id:"Wind Turbines"});m=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/6",{mode:X.MODE_ONDEMAND,outFields:[F],showLabels:true,id:"Street Centerlines"});v=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/1",{mode:X.MODE_ONDEMAND,id:"Perennial Streams"});k=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/10",{mode:X.MODE_ONDEMAND,opacity:0.3,id:"Zoning"});C=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/4",{mode:X.MODE_ONDEMAND,opacity:0.45,id:"Source Water Prot. Areas"});n=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/6",{mode:X.MODE_ONDEMAND,opacity:0.45,id:"Protected Species"});d=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/7",{mode:X.MODE_ONDEMAND,opacity:0.75,id:"Growth Areas"});l=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/FEMA/Flood_Hazard/MapServer/2",{mode:X.MODE_ONDEMAND,id:"Flood Hazard",opacity:0.75});app.map.addLayers([af,ad,E,m,v,k,C,n,d,l]);s=new P({id:"labels"});centerlinesLabel=new ak().setColor(new dojo.Color([30,30,30,0.5]));centerlinesLabel.font.setSize("12pt");centerlinesLabel.font.setFamily("arial");centerlinesLabelRenderer=new H(centerlinesLabel);s.addFeatureLayer(m,centerlinesLabelRenderer,"{"+F+"}");app.map.addLayer(s);e.forEach(["Parcels & Addresses","Cell Towers","Wind Turbines","Street Centerlines","Perennial Streams","Zoning","Source Water Prot. Areas","Protected Species","Growth Areas","Flood Hazard"],function(ap){new z({id:"cb_"+ap,name:"cb_"+ap,checked:true,onChange:function(aq){aq?app.map.getLayer(this.id.split("_")[1]).show():app.map.getLayer(this.id.split("_")[1]).hide()}},Z.create("input",{id:"lyr_"+ap})).placeAt(c.byId("layerToggle"));var ao=Z.create("label",{"for":"cb_"+ap,innerHTML:ap});Z.place(ao,c.byId("layerToggle"));Z.place(Z.create("br"),c.byId("layerToggle"))});app.symbols={};app.symbols.point=new an("square",10,new I(),new w([0,255,0,0.75]));app.symbols.polyline=new I("solid",new w([255,128,0]),2);app.symbols.polygon=new b().setColor(new w([255,255,0,0.25]));app.symbols.circle=new b().setColor(new w([0,0,180,0.25]));al(".drawing").forEach(function(ap){var ao=new ab({label:ap.innerHTML,onClick:function(){u(this.id)}},ap)});var A,ah;A=new K({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});ah=new G({id:"mapSelect",name:"map",value:"Printable",store:A,searchAttr:"name"},"mapSelect").startup();function ae(){var ap=dijit.byId("mapSelect").get("value"),aq,ao,ar;switch(ap){case"Measurement":ar="_blank";aq="measure.php";break;case"Planning and Zoning":aq="pz_map.php";ar="_blank";break;case"Flood Hazard":aq="FEMA_map.php";ar="_blank";break;case"Sensitive Areas":aq="sensitive.php";ar="_blank";break;case"Printable":aq="printable.php";ar="_self";break}var ao=aq+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(ao,ar)}ai.byId("launchButton").on("click",ae);function R(ap){var ao=N.webMercatorToGeographic(ap.getCenter());passedX=parseFloat(ao.x.toFixed(5));passedY=parseFloat(ao.y.toFixed(5));zoomLevel=app.map.getLevel()}function u(ao){if(ao==="label"){app.symbols.point=new an("circle",10,new I(),new w([255,0,0,0.75]));ao="point";esri.bundle.toolbars.draw.addPoint="Add a text label";j=true}else{if(ao==="point"){app.symbols.point=new an("square",10,new I(),new w([0,255,0,0.75]));esri.bundle.toolbars.draw.addPoint="Click to add a point";j=false}else{j=false}}app.tool=ao.replace("freehand","");app.toolbar.activate(ao);app.map.hideZoomSlider()}function t(ap){var av,ar,au;var aq=new V("20px",V.STYLE_NORMAL,V.VARIANT_NORMAL,V.WEIGHT_BOLDER);app.toolbar.deactivate();app.map.showZoomSlider();if(j){av=prompt("Enter a Text Label","");ar=ai.byId("includeCoords");if(ar.get("checked")){au="X: "+mpArray[0]+", Y: "+mpArray[1]+"  -  "+av}else{au=av}var at=new ak(au,aq,new w([0,0,0]));var aw=new f(ap.geometry,at);var ao=new f(ap.geometry,app.symbols[app.tool]);app.map.graphics.add(aw);app.map.graphics.add(ao)}else{var aw=new f(ap.geometry,app.symbols[app.tool]);app.map.graphics.add(aw)}}var y=new aa({map:app.map},"geosearch");y.startup()});