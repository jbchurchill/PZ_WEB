var app={};var mpArray;var passedCenter;app.map=null;app.toolbar=null;app.tool=null;app.symbols=null;app.printer=null;require(["esri/map","esri/toolbars/draw","esri/toolbars/edit","esri/dijit/Print","esri/dijit/Geocoder","esri/dijit/BasemapGallery","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/layers/GraphicsLayer","esri/tasks/PrintTemplate","esri/tasks/LegendLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/renderers/SimpleRenderer","esri/graphic","esri/config","dojo/_base/array","esri/Color","dojo/parser","dojo/query","dojo/dom","dojo/on","dojo/dom-construct","dojo/store/Memory","dijit/registry","dijit/form/CheckBox","dijit/form/ComboBox","dijit/form/Button","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojox/layout/ExpandoPane","dojo/domReady!"],function(v,aj,ap,l,R,ak,aw,e,S,ag,ab,au,U,an,r,z,W,A,I,ao,m,ax,N,f,w,Q,M,x,F,Z,n,Y,aq,s,i,o){Q.parse();N.defaults.io.proxyUrl="/proxy";var h,aa,L,af,g;var G=false;passedCenter=[passedX,passedY];app.map=new v("map",{basemap:"streets",center:passedCenter,zoom:zoomLevel});function K(){var aA,aF,aE,aB,az,aH,aC,aD,aG;aA=document.getElementById("textLatLong").value;aA=aA.replace(/\s+/g,"");aF=aA.indexOf(",");if(aF>0){aE=parseFloat(aA.slice(0,aF));aB=parseFloat(aA.substring(aF+1));console.log("latitude: "+aE);console.log("longitude: "+aB);az=new z(z.STYLE_SQUARE,12,new W(W.STYLE_SOLID,new w([10,10,10,0.75]),1),new w([255,0,0,0.5]));aH=new e(aB,aE,map.spatialRefernce);aC=new ax(aH,az,null,null);aD=new U();aD.add(aC);app.map.addLayer(aD);if(aC.geometry.type==="point"){aG=app.map.getMaxZoom();app.map.centerAndZoom(aC.geometry,aG-1)}else{app.map.setExtent(graphicsUtils.graphicsExtent([aC]))}}else{return""}}app.map.on("load",function(){app.toolbar=new aj(app.map);app.toolbar.on("draw-end",C);app.map.on("mouse-move",ai);app.map.on("mouse-drag",ai);dojo.connect(app.map,"onExtentChange",u);F(x.byId("submitLatLongButton"),"click",K);X(app.map)});function av(){app.map.graphics.clear()}function ai(az){var aA=aw.webMercatorToGeographic(az.mapPoint);x.byId("coordsinfo").innerHTML=aA.x.toFixed(5)+", "+aA.y.toFixed(5);mpArray=[aA.x.toFixed(5),aA.y.toFixed(5)]}function ar(){app.toolbar=new aj(app.map);ae("label");app.toolbar.on("draw-end",C);F.once(x.byId("map"),"click",ai)}h=new ak({showArcGISBasemaps:true,map:app.map},"basemapGallery");mdImagelayer=new S("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});h.add(mdImageBasemap);h.startup();h.on("error",function(az){console.log("basemap gallery error:  ",az)});aa=new r();aa.layerId="Zoning";L=new r();L.layerId="Protected Species";af=new r();af.layerId="Growth Areas";g=new r();g.layerId="Edge of Pavement";legSourceWater=new r();legSourceWater.layerId="Source Water Prot. Areas";var al,ay,E,B,T,at,V,p,a,ac,c,d,q;var j=0;function b(){if(j>0){app.printer.destroy()}j+=1;var aA;var aE=Y.byId("mapTitle");var az="Data from Garrett County Office of Planning and Land Management. Accuracy is not guaranteed (see http://gis.garrettcounty.org/).";var aB="Title and Graphics created by User at "+ip;aA=aE.get("value");var aD=[{name:"Letter ANSI A Landscape",label:"Landscape (PDF)",format:"pdf",options:{legendLayers:[aa,L,af,g,legSourceWater],scalebarUnit:"Miles",titleText:aA+", Landscape PDF",copyrightText:aB,authorText:az}},{name:"Letter ANSI A Portrait",label:"Portrait (Image)",format:"jpg",options:{legendLayers:[aa,L,af,g,legSourceWater],scaleBarUnit:"Miles",titleText:aA+", Portrait JPG",copyrightText:aB,authorText:az}},{name:"Letter ANSI A Landscape",label:"Landscape (Image)",format:"jpg",options:{legendLayers:[aa,L,af,g,legSourceWater],scaleBarUnit:"Miles",titleText:aA+", Landscape JPG",copyrightText:aB,authorText:az}},{name:"Letter ANSI A Portrait",label:"Portrait (PDF)",format:"pdf",options:{legendLayers:[aa,L,af,g,legSourceWater],scaleBarUnit:"Miles",titleText:aA+", Portrait PDF",copyrightText:aB,authorText:az}}];var aC=f.map(aD,function(aG){var aF=new an();aF.layout=aG.name;aF.label=aG.label;aF.format=aG.format;aF.layoutOptions=aG.options;return aF});app.printer=new l({map:app.map,templates:aC,url:"http://gis.garrettcounty.org:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"},x.byId("printButton"));app.printer.startup()}F(x.byId("prepMap"),"click",b);F(x.byId("clearGraphics"),"click",av);F(x.byId("textLabel"),"click",ar);var t,D,ad,J,ah,H;t=new au();t.layerIds=[1,4,5,6,7];t.layerOption=au.LAYER_OPTION_SHOW;D=new au();D.layerIds=[4,8];D.layerOption=au.LAYER_OPTION_SHOW;H="RDNAMELOCAL";ad=new au();ad.layerIds=[2,3,4,5,6,7,8,9];ad.layerOption=au.LAYER_OPTION_SHOW;J=new au();J.layerIds=[11,12,13,14];J.layerOption=au.LAYER_OPTION_SHOW;al=new ag("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:D,opacity:0.75,id:"Parcels & Addresses"});ay=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/5",{mode:ab.MODE_ONDEMAND,id:"Cell Towers"});E=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/3",{mode:ab.MODE_ONDEMAND,id:"Wind Turbines"});B=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/6",{mode:ab.MODE_ONDEMAND,outFields:[H],showLabels:true,id:"Street Centerlines"});T=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/1",{mode:ab.MODE_ONDEMAND,id:"Perennial Streams"});at=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/10",{mode:ab.MODE_ONDEMAND,opacity:0.3,id:"Zoning"});V=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/4",{mode:ab.MODE_ONDEMAND,opacity:0.45,id:"Source Water Prot. Areas"});p=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/6",{mode:ab.MODE_ONDEMAND,opacity:0.45,id:"Protected Species"});a=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/7",{mode:ab.MODE_ONDEMAND,opacity:0.75,id:"Growth Areas"});ac=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/FEMA/Flood_Hazard/MapServer/2",{mode:ab.MODE_ONDEMAND,id:"Flood Hazard",opacity:0.75});c=new ab("http://gis.garrettcounty.org:6080/arcgis/rest/services/Contours_and_Plan/Contours_and_Plan/MapServer/0",{mode:ab.MODE_ONDEMAND,opacity:0.75,id:"Building Footprints"});d=new ag("http://gis.garrettcounty.org:6080/arcgis/rest/services/Contours_and_Plan/Contours_and_Plan/MapServer",{imageParameters:ad,opacity:0.75,id:"Edge of Pavement"});q=new ag("http://gis.garrettcounty.org:6080/arcgis/rest/services/Contours_and_Plan/Contours_and_Plan/MapServer",{imageParameters:J,opacity:0.75,id:"Contours"});app.map.addLayers([al,ay,E,B,T,at,V,p,a,ac,c,d,q]);f.forEach(["Parcels & Addresses","Cell Towers","Wind Turbines","Street Centerlines","Perennial Streams","Zoning","Source Water Prot. Areas","Protected Species","Growth Areas","Flood Hazard","Building Footprints","Edge of Pavement","Contours"],function(aA){new aq({id:"cb_"+aA,name:"cb_"+aA,checked:true,onChange:function(aB){aB?app.map.getLayer(this.id.split("_")[1]).show():app.map.getLayer(this.id.split("_")[1]).hide()}},Z.create("input",{id:"lyr_"+aA})).placeAt(x.byId("layerToggle"));var az=Z.create("label",{"for":"cb_"+aA,innerHTML:aA});Z.place(az,x.byId("layerToggle"));Z.place(Z.create("br"),x.byId("layerToggle"))});app.symbols={};app.symbols.point=new z("square",10,new W(),new w([0,255,0,0.75]));app.symbols.polyline=new W("solid",new w([255,128,0]),2);app.symbols.polygon=new A().setColor(new w([255,255,0,0.25]));app.symbols.circle=new A().setColor(new w([0,0,180,0.25]));app.symbols.line=new W("solid",new w([180,10,80]),2);M(".drawing").forEach(function(aA){var az=new i({label:aA.innerHTML,onClick:function(){ae(this.id)}},aA)});var P,k;P=new n({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});k=new s({id:"mapSelect",name:"map",value:"Printable",store:P,searchAttr:"name"},"mapSelect").startup();function am(){var aA=dijit.byId("mapSelect").get("value"),aB,az,aC;switch(aA){case"Measurement":aC="_blank";aB="measure.php";break;case"Planning and Zoning":aB="pz_map.php";aC="_blank";break;case"Flood Hazard":aB="FEMA_map.php";aC="_blank";break;case"Sensitive Areas":aB="sensitive.php";aC="_blank";break;case"Printable":aB="printable.php";aC="_self";break}az=aB+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(az,aC)}Y.byId("launchButton").on("click",am);function u(aA){var az=aw.webMercatorToGeographic(aA.getCenter());passedX=parseFloat(az.x.toFixed(5));passedY=parseFloat(az.y.toFixed(5));zoomLevel=app.map.getLevel()}function ae(az){if(az==="label"){app.symbols.point=new z("circle",10,new W(),new w([255,0,0,0.75]));az="point";esri.bundle.toolbars.draw.addPoint="Add a text label";G=true}else{if(az==="point"){app.symbols.point=new z("square",10,new W(),new w([0,255,0,0.75]));esri.bundle.toolbars.draw.addPoint="Click to add a point";G=false}else{if(az==="arrow"){app.symbols.arrow=new A().setColor(new w([0,0,180,0.25]))}else{if(az==="rectangle"){app.symbols.rectangle=new A().setColor(new w([0,180,39,0.25]))}else{G=false}}}}app.tool=az.replace("freehand","");app.toolbar.activate(az);app.map.hideZoomSlider()}function X(){dojo.connect(dijit.byId("map"),"resize",app.map,app.map.resize);ap=new esri.toolbars.Edit(app.map);dojo.connect(app.map.graphics,"onClick",function(az){dojo.stopEvent(az);y(az.graphic)});dojo.connect(app.map,"onClick",function(az){ap.deactivate()})}function y(aA){var az={allowAddVertices:true,allowDeleteVertices:true};ap.activate(esri.toolbars.Edit.EDIT_VERTICES|esri.toolbars.Edit.ROTATE,aA,az)}function C(aA){var aF,aD,aC,aE,aG,az;var aB=new ao("20px",ao.STYLE_NORMAL,ao.VARIANT_NORMAL,ao.WEIGHT_BOLDER,"Ariel");app.toolbar.deactivate();app.map.showZoomSlider();if(G){aF=prompt("Enter a Text Label","");aC=Y.byId("includeCoords");if(aC.get("checked")){aE="X: "+mpArray[0]+", Y: "+mpArray[1]+"  -  "+aF}else{aE=aF}aD=new I(aE,aB,new w([0,0,0]));aG=new ax(aA.geometry,aD);az=new ax(aA.geometry,app.symbols[app.tool]);app.map.graphics.add(aG);app.map.graphics.add(az)}else{aG=new ax(aA.geometry,app.symbols[app.tool]);app.map.graphics.add(aG)}G=false}var O=new R({map:app.map},"geosearch");O.startup()});