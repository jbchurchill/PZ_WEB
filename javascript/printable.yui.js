var app={};var mpArray;var passedCenter;var gLayer;app.map=null;app.toolbar=null;app.tool=null;app.symbols=null;app.printer=null;require(["esri/map","esri/toolbars/draw","esri/dijit/Print","esri/dijit/Geocoder","esri/dijit/BasemapGallery","esri/geometry/webMercatorUtils","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/layers/GraphicsLayer","esri/tasks/PrintTemplate","esri/tasks/LegendLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/renderers/SimpleRenderer","esri/graphic","esri/config","dojo/_base/array","esri/Color","dojo/parser","dojo/query","dojo/dom","dojo/on","dojo/dom-construct","dojo/store/Memory","dijit/registry","dijit/form/CheckBox","dijit/form/ComboBox","dijit/form/Button","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojox/layout/ExpandoPane","dojo/domReady!"],function(p,W,N,Y,U,L,B,v,V,aj,T,o,Q,ak,G,b,ah,S,F,f,z,e,u,K,ai,c,M,X,I,af,x,E,Z,H){K.parse();z.defaults.io.proxyUrl="/proxy";var g;var j=false;passedCenter=[passedX,passedY];app.map=new p("map",{basemap:"streets",center:passedCenter,zoom:zoomLevel});app.map.on("load",function(){app.toolbar=new W(app.map);app.toolbar.on("draw-end",r);app.map.on("mouse-move",i);app.map.on("mouse-drag",i);dojo.connect(app.map,"onExtentChange",O)});function a(){app.map.graphics.clear()}function i(al){var am=L.webMercatorToGeographic(al.mapPoint);c.byId("coordsinfo").innerHTML=am.x.toFixed(5)+", "+am.y.toFixed(5);mpArray=[am.x.toFixed(5),am.y.toFixed(5)]}function h(){app.toolbar=new W(app.map);s("label");app.toolbar.on("draw-end",r);M.once(c.byId("map"),"click",i)}g=new U({showArcGISBasemaps:true,map:app.map},"basemapGallery");mdImagelayer=new B("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});g.add(mdImageBasemap);g.startup();g.on("error",function(al){console.log("basemap gallery error:  ",al)});var P=new Q();P.layerId="Zoning";var ad,ab,C,m,t,k,A,n,d,l;var ag=0;function R(){if(ag>0){return}ag+=1;var am;var aq=af.byId("mapTitle");var al="Data from Garrett County Office of Planning and Land Management. Accuracy is not guaranteed (see http://gis.garrettcounty.org/).";var an="Title and Graphics created by User at "+ip;am=aq.get("value");var ap=[{name:"Letter ANSI A Landscape",label:"Landscape (PDF)",format:"pdf",options:{legendLayers:[P],scalebarUnit:"Miles",titleText:am+", Landscape PDF",copyrightText:an,authorText:al}},{name:"Letter ANSI A Portrait",label:"Portrait (Image)",format:"jpg",options:{legendLayers:[P],scaleBarUnit:"Miles",titleText:am+", Portrait JPG",copyrightText:an,authorText:al}},{name:"Letter ANSI A Landscape",label:"Landscape (Image)",format:"jpg",options:{legendLayers:[P],scaleBarUnit:"Miles",titleText:am+", Landscape JPG",copyrightText:an,authorText:al}},{name:"Letter ANSI A Portrait",label:"Portrait (PDF)",format:"pdf",options:{legendLayers:[P],scaleBarUnit:"Miles",titleText:am+", Portrait PDF",copyrightText:an,authorText:al}}];var ao=e.map(ap,function(at){var ar=new o();ar.layout=at.name;ar.label=at.label;ar.format=at.format;ar.layoutOptions=at.options;return ar});app.printer=new N({map:app.map,templates:ao,url:"http://gis.garrettcounty.org:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"},c.byId("printButton"));app.printer.startup()}M(c.byId("prepMap"),"click",R);M(c.byId("clearGraphics"),"click",a);M(c.byId("textLabel"),"click",h);var J,aa,q,D;J=new aj();J.layerIds=[1,4,5,6,7];J.layerOption=aj.LAYER_OPTION_SHOW;aa=new aj();aa.layerIds=[4,8];aa.layerOption=aj.LAYER_OPTION_SHOW;D="RDNAMELOCAL";ad=new v("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:aa,opacity:0.75,id:"Parcels & Addresses"});ab=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/5",{mode:V.MODE_ONDEMAND,id:"Cell Towers"});C=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/3",{mode:V.MODE_ONDEMAND,id:"Wind Turbines"});m=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/6",{mode:V.MODE_ONDEMAND,outFields:[D],showLabels:true,id:"Street Centerlines"});t=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/1",{mode:V.MODE_ONDEMAND,id:"Perennial Streams"});k=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/10",{mode:V.MODE_ONDEMAND,opacity:0.3,id:"Zoning"});A=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/4",{mode:V.MODE_ONDEMAND,opacity:0.45,id:"Source Water Prot. Areas"});n=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/6",{mode:V.MODE_ONDEMAND,opacity:0.45,id:"Protected Species"});d=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/7",{mode:V.MODE_ONDEMAND,opacity:0.75,id:"Growth Areas"});l=new V("http://gis.garrettcounty.org:6080/arcgis/rest/services/FEMA/Flood_Hazard/MapServer/2",{mode:V.MODE_ONDEMAND,id:"Flood Hazard",opacity:0.75});app.map.addLayers([ad,ab,C,m,t,k,A,n,d,l]);e.forEach(["Parcels & Addresses","Cell Towers","Wind Turbines","Street Centerlines","Perennial Streams","Zoning","Source Water Prot. Areas","Protected Species","Growth Areas","Flood Hazard"],function(am){new x({id:"cb_"+am,name:"cb_"+am,checked:true,onChange:function(an){an?app.map.getLayer(this.id.split("_")[1]).show():app.map.getLayer(this.id.split("_")[1]).hide()}},X.create("input",{id:"lyr_"+am})).placeAt(c.byId("layerToggle"));var al=X.create("label",{"for":"cb_"+am,innerHTML:am});X.place(al,c.byId("layerToggle"));X.place(X.create("br"),c.byId("layerToggle"))});app.symbols={};app.symbols.point=new ak("square",10,new G(),new u([0,255,0,0.75]));app.symbols.polyline=new G("solid",new u([255,128,0]),2);app.symbols.polygon=new b().setColor(new u([255,255,0,0.25]));app.symbols.circle=new b().setColor(new u([0,0,180,0.25]));app.symbols.line=new G("solid",new u([180,10,80]),2);ai(".drawing").forEach(function(am){var al=new Z({label:am.innerHTML,onClick:function(){s(this.id)}},am)});var y,ae;y=new I({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});ae=new E({id:"mapSelect",name:"map",value:"Printable",store:y,searchAttr:"name"},"mapSelect").startup();function ac(){var am=dijit.byId("mapSelect").get("value"),an,al,ao;switch(am){case"Measurement":ao="_blank";an="measure.php";break;case"Planning and Zoning":an="pz_map.php";ao="_blank";break;case"Flood Hazard":an="FEMA_map.php";ao="_blank";break;case"Sensitive Areas":an="sensitive.php";ao="_blank";break;case"Printable":an="printable.php";ao="_self";break}var al=an+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(al,ao)}af.byId("launchButton").on("click",ac);function O(am){var al=L.webMercatorToGeographic(am.getCenter());passedX=parseFloat(al.x.toFixed(5));passedY=parseFloat(al.y.toFixed(5));zoomLevel=app.map.getLevel()}function s(al){if(al==="label"){app.symbols.point=new ak("circle",10,new G(),new u([255,0,0,0.75]));al="point";esri.bundle.toolbars.draw.addPoint="Add a text label";j=true}else{if(al==="point"){app.symbols.point=new ak("square",10,new G(),new u([0,255,0,0.75]));esri.bundle.toolbars.draw.addPoint="Click to add a point";j=false}else{if(al==="arrow"){app.symbols.arrow=new b().setColor(new u([0,0,180,0.25]))}else{j=false}}}app.tool=al.replace("freehand","");app.toolbar.activate(al);app.map.hideZoomSlider()}function r(am){app.gLayer=new T();var ar,ap,ao,aq,at,al;var an=new S("20px",S.STYLE_NORMAL,S.VARIANT_NORMAL,S.WEIGHT_BOLDER,"Ariel");app.toolbar.deactivate();app.map.showZoomSlider();if(j){ar=prompt("Enter a Text Label","");ao=af.byId("includeCoords");if(ao.get("checked")){aq="X: "+mpArray[0]+", Y: "+mpArray[1]+"  -  "+ar}else{aq=ar}ap=new ah(aq,an,new u([0,0,0]));at=new f(am.geometry,ap);al=new f(am.geometry,app.symbols[app.tool]);app.map.graphics.add(at);app.map.graphics.add(al)}else{at=new f(am.geometry,app.symbols[app.tool]);app.map.graphics.add(at)}j=false}var w=new Y({map:app.map},"geosearch");w.startup()});