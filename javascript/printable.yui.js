var app={};var mpArray;var passedCenter;var gLayer;app.map=null;app.toolbar=null;app.tool=null;app.symbols=null;app.printer=null;require(["esri/map","esri/toolbars/draw","esri/dijit/Print","esri/dijit/Geocoder","esri/dijit/BasemapGallery","esri/geometry/webMercatorUtils","esri/geometry/Point","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/layers/GraphicsLayer","esri/tasks/PrintTemplate","esri/tasks/LegendLayer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/TextSymbol","esri/symbols/Font","esri/renderers/SimpleRenderer","esri/graphic","esri/config","dojo/_base/array","esri/Color","dojo/parser","dojo/query","dojo/dom","dojo/on","dojo/dom-construct","dojo/store/Memory","dijit/registry","dijit/form/CheckBox","dijit/form/ComboBox","dijit/form/Button","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","dojox/layout/ExpandoPane","dojo/domReady!"],function(p,Y,O,aa,V,M,F,B,v,X,al,U,o,R,am,H,b,aj,T,G,f,z,e,u,L,ak,c,N,Z,J,ah,x,E,ab,I){L.parse();z.defaults.io.proxyUrl="/proxy";var g;var j=false;passedCenter=[passedX,passedY];app.map=new p("map",{basemap:"streets",center:passedCenter,zoom:zoomLevel});function W(){var ao,au,at,ap,an,aw,aq,ar,av;ao=document.getElementById("textLatLong").value;ao=ao.replace(/\s+/g,"");au=ao.indexOf(",");if(au>0){at=ao.slice(0,au);ap=ao.substring(au+1);an=new am(am.STYLE_SQUARE,12,new H(H.STYLE_SOLID,new u([10,10,10,0.75]),1),new u([255,0,0,0.5]));aw=new F(ap,at,map.spatialRefernce);aq=new f(aw,an,null,null);ar=new U();ar.add(aq);app.map.addLayer(ar);if(aq.geometry.type==="point"){av=app.map.getMaxZoom();app.map.centerAndZoom(aq.geometry,av-1)}else{app.map.setExtent(graphicsUtils.graphicsExtent([aq]))}}else{return""}}app.map.on("load",function(){app.toolbar=new Y(app.map);app.toolbar.on("draw-end",r);app.map.on("mouse-move",i);app.map.on("mouse-drag",i);dojo.connect(app.map,"onExtentChange",P);N(c.byId("submitLatLongButton"),"click",W)});function a(){app.map.graphics.clear()}function i(an){var ao=M.webMercatorToGeographic(an.mapPoint);c.byId("coordsinfo").innerHTML=ao.x.toFixed(5)+", "+ao.y.toFixed(5);mpArray=[ao.x.toFixed(5),ao.y.toFixed(5)]}function h(){app.toolbar=new Y(app.map);s("label");app.toolbar.on("draw-end",r);N.once(c.byId("map"),"click",i)}g=new V({showArcGISBasemaps:true,map:app.map},"basemapGallery");mdImagelayer=new B("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});g.add(mdImageBasemap);g.startup();g.on("error",function(an){console.log("basemap gallery error:  ",an)});var Q=new R();Q.layerId="Zoning";var af,ad,C,m,t,k,A,n,d,l;var ai=0;function S(){if(ai>0){return}ai+=1;var ao;var at=ah.byId("mapTitle");var an="Data from Garrett County Office of Planning and Land Management. Accuracy is not guaranteed (see http://gis.garrettcounty.org/).";var ap="Title and Graphics created by User at "+ip;ao=at.get("value");var ar=[{name:"Letter ANSI A Landscape",label:"Landscape (PDF)",format:"pdf",options:{legendLayers:[Q],scalebarUnit:"Miles",titleText:ao+", Landscape PDF",copyrightText:ap,authorText:an}},{name:"Letter ANSI A Portrait",label:"Portrait (Image)",format:"jpg",options:{legendLayers:[Q],scaleBarUnit:"Miles",titleText:ao+", Portrait JPG",copyrightText:ap,authorText:an}},{name:"Letter ANSI A Landscape",label:"Landscape (Image)",format:"jpg",options:{legendLayers:[Q],scaleBarUnit:"Miles",titleText:ao+", Landscape JPG",copyrightText:ap,authorText:an}},{name:"Letter ANSI A Portrait",label:"Portrait (PDF)",format:"pdf",options:{legendLayers:[Q],scaleBarUnit:"Miles",titleText:ao+", Portrait PDF",copyrightText:ap,authorText:an}}];var aq=e.map(ar,function(av){var au=new o();au.layout=av.name;au.label=av.label;au.format=av.format;au.layoutOptions=av.options;return au});app.printer=new O({map:app.map,templates:aq,url:"http://gis.garrettcounty.org:6080/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"},c.byId("printButton"));app.printer.startup()}N(c.byId("prepMap"),"click",S);N(c.byId("clearGraphics"),"click",a);N(c.byId("textLabel"),"click",h);var K,ac,q,D;K=new al();K.layerIds=[1,4,5,6,7];K.layerOption=al.LAYER_OPTION_SHOW;ac=new al();ac.layerIds=[4,8];ac.layerOption=al.LAYER_OPTION_SHOW;D="RDNAMELOCAL";af=new v("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer",{imageParameters:ac,opacity:0.75,id:"Parcels & Addresses"});ad=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/5",{mode:X.MODE_ONDEMAND,id:"Cell Towers"});C=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/3",{mode:X.MODE_ONDEMAND,id:"Wind Turbines"});m=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/6",{mode:X.MODE_ONDEMAND,outFields:[D],showLabels:true,id:"Street Centerlines"});t=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/1",{mode:X.MODE_ONDEMAND,id:"Perennial Streams"});k=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/P_and_Z/Parcels_and_Zoning/MapServer/10",{mode:X.MODE_ONDEMAND,opacity:0.3,id:"Zoning"});A=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/4",{mode:X.MODE_ONDEMAND,opacity:0.45,id:"Source Water Prot. Areas"});n=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/6",{mode:X.MODE_ONDEMAND,opacity:0.45,id:"Protected Species"});d=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer/7",{mode:X.MODE_ONDEMAND,opacity:0.75,id:"Growth Areas"});l=new X("http://gis.garrettcounty.org:6080/arcgis/rest/services/FEMA/Flood_Hazard/MapServer/2",{mode:X.MODE_ONDEMAND,id:"Flood Hazard",opacity:0.75});app.map.addLayers([af,ad,C,m,t,k,A,n,d,l]);e.forEach(["Parcels & Addresses","Cell Towers","Wind Turbines","Street Centerlines","Perennial Streams","Zoning","Source Water Prot. Areas","Protected Species","Growth Areas","Flood Hazard"],function(ao){new x({id:"cb_"+ao,name:"cb_"+ao,checked:true,onChange:function(ap){ap?app.map.getLayer(this.id.split("_")[1]).show():app.map.getLayer(this.id.split("_")[1]).hide()}},Z.create("input",{id:"lyr_"+ao})).placeAt(c.byId("layerToggle"));var an=Z.create("label",{"for":"cb_"+ao,innerHTML:ao});Z.place(an,c.byId("layerToggle"));Z.place(Z.create("br"),c.byId("layerToggle"))});app.symbols={};app.symbols.point=new am("square",10,new H(),new u([0,255,0,0.75]));app.symbols.polyline=new H("solid",new u([255,128,0]),2);app.symbols.polygon=new b().setColor(new u([255,255,0,0.25]));app.symbols.circle=new b().setColor(new u([0,0,180,0.25]));app.symbols.line=new H("solid",new u([180,10,80]),2);ak(".drawing").forEach(function(ao){var an=new ab({label:ao.innerHTML,onClick:function(){s(this.id)}},ao)});var y,ag;y=new J({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});ag=new E({id:"mapSelect",name:"map",value:"Printable",store:y,searchAttr:"name"},"mapSelect").startup();function ae(){var ao=dijit.byId("mapSelect").get("value"),ap,an,aq;switch(ao){case"Measurement":aq="_blank";ap="measure.php";break;case"Planning and Zoning":ap="pz_map.php";aq="_blank";break;case"Flood Hazard":ap="FEMA_map.php";aq="_blank";break;case"Sensitive Areas":ap="sensitive.php";aq="_blank";break;case"Printable":ap="printable.php";aq="_self";break}var an=ap+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(an,aq)}ah.byId("launchButton").on("click",ae);function P(ao){var an=M.webMercatorToGeographic(ao.getCenter());passedX=parseFloat(an.x.toFixed(5));passedY=parseFloat(an.y.toFixed(5));zoomLevel=app.map.getLevel()}function s(an){if(an==="label"){app.symbols.point=new am("circle",10,new H(),new u([255,0,0,0.75]));an="point";esri.bundle.toolbars.draw.addPoint="Add a text label";j=true}else{if(an==="point"){app.symbols.point=new am("square",10,new H(),new u([0,255,0,0.75]));esri.bundle.toolbars.draw.addPoint="Click to add a point";j=false}else{if(an==="arrow"){app.symbols.arrow=new b().setColor(new u([0,0,180,0.25]))}else{j=false}}}app.tool=an.replace("freehand","");app.toolbar.activate(an);app.map.hideZoomSlider()}function r(ao){app.gLayer=new U();var au,ar,aq,at,av,an;var ap=new T("20px",T.STYLE_NORMAL,T.VARIANT_NORMAL,T.WEIGHT_BOLDER,"Ariel");app.toolbar.deactivate();app.map.showZoomSlider();if(j){au=prompt("Enter a Text Label","");aq=ah.byId("includeCoords");if(aq.get("checked")){at="X: "+mpArray[0]+", Y: "+mpArray[1]+"  -  "+au}else{at=au}ar=new aj(at,ap,new u([0,0,0]));av=new f(ao.geometry,ar);an=new f(ao.geometry,app.symbols[app.tool]);app.map.graphics.add(av);app.map.graphics.add(an)}else{av=new f(ao.geometry,app.symbols[app.tool]);app.map.graphics.add(av)}j=false}var w=new aa({map:app.map},"geosearch");w.startup()});