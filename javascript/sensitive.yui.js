var map,zoom,center,scalebar,checkNull,formatProtectedSpecies,formatFLU,content;var saParameters,mdImageLayer,mdImageBasemap,geocoder,mapLaunchStore,comboBox;var parcelTemplate,addrTemplate,streetTemplate,pstreamTemplate,swpaTemplate,growthAreasTemplate,protectedSpeciesTemplate,SA_fLayer,basemapGallery;var passedCenter,passedX,passedY,zoomLevel;require(["esri/map","esri/dijit/Scalebar","esri/dijit/Popup","esri/dijit/BasemapGallery","dojo/dom","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters","esri/geometry/webMercatorUtils","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/Color","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/InfoTemplate","esri/dijit/Geocoder","dojo/parser","dojo/domReady!"],function(e,x,i,h,u,o,A,k,r,z,j,g,p,q,B,f,d,C,b,y,m,n,c){c.parse();var a=new i({fillSymbol:new f(f.STYLE_SOLID,new d(d.STYLE_SOLID,new C([255,0,0]),2),new C([255,255,0,0.25]))},dojo.create("div"));function s(){var E=dijit.byId("mapSelect").get("value"),F,D,G;switch(E){case"Measurement":F="measure.php";G="_blank";break;case"Planning and Zoning":F="pz_map.php";G="_blank";break;case"Flood Hazard":F="FEMA_map.php";G="_blank";break;case"Sensitive Areas":F="sensitive.php";G="_self";break;case"Printable":F="printable.php";G="_blank";break}D=F+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(D,G)}function l(){var D=B.webMercatorToGeographic(map.extent.getCenter());passedX=parseFloat(D.x.toFixed(5));passedY=parseFloat(D.y.toFixed(5));zoomLevel=map.getLevel()}function w(){var E,D;E=document.querySelector(".esriPopup");if(E){D=new dojo.dnd.Moveable(u.byId(E))}return D}passedCenter=[passedX,passedY];k.byId("launchButton").on("click",s);function t(){dojo.connect(map,"onExtentChange",l)}map=new e("mapDiv",{basemap:"streets",center:passedCenter,zoom:zoomLevel,infoWindow:a});scalebar=new x({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});map.on("load",t);mapLaunchStore=new o({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"},{name:"Printable",id:"PRINT",baseURL:"printable.php"}]});comboBox=new A({id:"mapSelect",name:"map",value:"Sensitive Areas",store:mapLaunchStore,searchAttr:"name"},"mapSelect").startup();checkNull=function(E,D){function F(H,I,G){if(H==""|H=="Null"){content=""}else{if(G){if(I=='SDAT Link: <a href="'){H+='" target="_blank">LINK</a>'}H+="<br />"}content=I+H}}switch(D){case"SUBDIVSN":F(E,"Subdivision: ",true);break;case"PLAT":F(E,"Plat: ",true);break;case"BLOCK":F(E,"Block: ",true);break;case"PLTLIBER":F(E,'<hr><span class="sectionhead">Plat Reference</span><br />Liber: ',true);break;case"PLTFOLIO":F(E,"Folio: ",true);break;case"OWNNAME2":F(E," ",false);break;case"SDATWEBADR":F(E,'SDAT Link: <a href="',true);break;case"DR1LIBER":F(E,'<hr><span class="sectionhead">Deed Reference</span><br />Liber: ',true);break;case"DR1FOLIO":F(E,"Folio: ",true);break;case"CITY":F(E,"City: ",true);break}return content};formatProtectedSpecies=function(E,D){if(D=="GROUP"&&E=="Null"){content=""}else{if(D=="GROUP"&&E=="GROUP 1"){content="Type: Federally Protected Species"}else{if(D=="GROUP"&&E=="GROUP 2"){content="Type: State Protected Species"}}}return content};formatFLU=function(E,D){if(D=="FLU"&&E=="Null"){content=""}else{if(D=="FLU"&&E=="A"){content=E+" &#045; Permitted Accessory Use"}else{if(D=="FLU"&&E=="AR"){content=E+" &#045; Agricultural Resource"}else{if(D=="FLU"&&E=="C"){content=E+" &#045; General Commercial"}else{if(D=="FLU"&&E=="CR1"){content=E+" &#045; Commercial Resort 1"}else{if(D=="FLU"&&E=="CR2"){content=E+" &#045; Commercial Resort 2"}else{if(D=="FLU"&&E=="LR1"){content=E+" &#045; Lake Residential 1"}else{if(D=="FLU"&&E=="LR2"){content=E+" &#045; Lake Residential 2"}else{if(D=="FLU"&&E=="N"){content=E+" &#045; Not Permitted"}else{if(D=="FLU"&&E=="P"){content=E+" &#045; Permitted by Right Use"}else{if(D=="FLU"&&E=="RR"){content=E+" &#045; Rural Resource"}else{if(D=="FLU"&&E=="SE"){content=E+" &#045; Special Exception"}else{if(D=="FLU"&&E=="TC"){content=E+" &#045; Town Center"}else{if(D=="FLU"&&E=="TR"){content=E+" &#045; Town Residential"}else{if(D=="FLU"&&E=="EC"){content=E+" &#045; Employment Center"}else{if(D=="FLU"&&E=="GC"){content=E+" &#045; General Commercial"}else{if(D=="FLU"&&E=="SR"){content=E+" &#045; Suburban Residential"}}}}}}}}}}}}}}}}}return content};parcelTemplate=new m("Parcel Info",'<span class="sectionhead">Layer: Parcels</span><br /><br /><hr>Address: ${ADDRESS} <br />${CITY:checkNull} Owner: ${OWNNAME1} ${OWNNAME2:checkNull} <br /> Tax Id: ${ACCTID} <br />${DR1LIBER:checkNull} ${DR1FOLIO:checkNull} <hr> ${SUBDIVSN:checkNull} ${PLAT:checkNull} ${BLOCK:checkNull} Grid: ${GRID} <br />Map: ${MAP} <br /> Parcel: ${PARCEL} <br /> Lot: ${LOT} <br /> Area: ${ACRES} Acres <br />${PLTLIBER:checkNull} ${PLTFOLIO:checkNull} <hr>Year Built: ${YRBLT_CAMA} <br /> ${SDATWEBADR:checkNull}');addrTemplate=new m("Address Info",'<span class="sectionhead">Layer: Address Points</span><br /><br /><hr>Address: ${ADDRESS} <br /><br /> City: ${CITY} <br /> Zip: ${ZIP_CODE} <br /> ESN: ${ESN} <br /> Community: ${COMMUNITY} <br /> Map: ${MAP} <br /> Parcel: ${PARCEL} <br />Lot: ${LOT} <br /> Tract: ${TRACT} <br /> LU: ${LU} <br /> Key date: ${KEYDATE} <br /> Rental: ${RENTAL} <br />Rental Co.: ${RENTAL_CO} <br /> Tax Account: ${TAX_ACCOUNT_ID} <br /> Owner: ${OWNER_FIRST_NAME} ${OWNER_LAST_NAME} <br />');streetTemplate=new m("Street Info",'<span class="sectionhead">Layer: Street Centerlines</span><br /><br /><hr>Name: ${STREET_ALL} <br />Maintenance: ${MAINTENANCE} <br /> Length: ${SHAPE.len:NumberFormat(places:1)} feet <br />');pstreamTemplate=new m("Stream Info",'<span class="sectionhead">Layer: Perennial Streams</span><br /><br /><hr>Stream Segment Length: ${SHAPE_Leng:NumberFormat(places:1)} feet');swpaTemplate=new m("Source Water Info",'<span class="sectionhead">Layer: Source Water Protection Areas</span><br /><br />Water System: ${WHPAs_Me_2} <br /> Geology: ${WHPAs_Me_6} <br /> Project Info: ${WHPAs_M_11} <br /> Location: ${WHPAs_M_12} <br />Source: ${CWS_SRC_NA} <br /> Completion Date: ${CWS_COMP_D} <br /> Aquifer: ${CWS_AQUIFE} <br />');growthAreasTemplate=new m("Growth Areas Info",'<span class="sectionhead">Layer: Growth Areas</span><br /><br />Land Use: ${GENZONE} <br /> Acreage: ${ACRES:NumberFormat(places:2)} <br /> Zoning: ${FLU:formatFLU}');protectedSpeciesTemplate=new m("Protected Species Info",'<span class="sectionhead">Layer: Protected Species</span><br /><br /><hr>${GROUP:formatProtectedSpecies}');dclTemplate=new m("Deep Creek Lake",'<span class="sectionhead">Layer: Deep Creek Lake</span><br /><br /><hr>Estimated Acreage: ${Acreage:NumberFormat(places:0)}');saParameters=new q();saParameters.layerIds=[0,1,2,3,4,5,6,7];saParameters.layerOption=q.LAYER_OPTION_SHOW;SA_fLayer=new g("http://maps.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer",{imageParameters:saParameters,opacity:0.75});map.addLayer(SA_fLayer);basemapGallery=new h({showArcGISBasemaps:true,map:map},"basemapGallery");mdImagelayer=new esri.layers.ArcGISTiledMapServiceLayer("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/ImageServer");mdImage2011=new esri.layers.ArcGISTiledMapServiceLayer("http://imagery.geodata.md.gov/imap/rest/services/SixInch/SixInchImagery2011_2013/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImagelayer],title:"MD 2014 Imagery",thumbnailUrl:"http://maps.garrettcounty.org/arcgis/images/image2014.png"});mdImageBasemap2011=new esri.dijit.Basemap({layers:[mdImage2011],title:"MD 2011 Imagery",thumbnailUrl:"http://maps.garrettcounty.org/arcgis/images/image_v2.png"});basemapGallery.add(mdImageBasemap);basemapGallery.add(mdImageBasemap2011);basemapGallery.startup();basemapGallery.on("error",function(D){console.log("basemap gallery error:  ",D)});function v(E){var H,G,D,F=new b("http://maps.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer");G=[0,1,2,3,4,5,6,7];D=new y();D.tolerance=3;D.returnGeometry=true;D.layerOption=y.LAYER_OPTION_VISIBLE;D.layerIds=G;D.width=map.width;D.height=map.height;D.geometry=E.mapPoint;D.mapExtent=map.extent;D.tolerance=3;D.SpatialReference=102100;H=F.execute(D);H.addCallback(function(I){return dojo.map(I,function(J){var K=J.feature;if(J.layerName==="addresspoints"){K.setInfoTemplate(addrTemplate)}else{if(J.layerName==="Parcels"){K.setInfoTemplate(parcelTemplate)}else{if(J.layerName==="centerlines"){K.setInfoTemplate(streetTemplate)}else{if(J.layerName==="GrowthAreas"){K.setInfoTemplate(growthAreasTemplate)}else{if(J.layerName==="Source Water Protection Areas"){K.setInfoTemplate(swpaTemplate)}else{if(J.layerName==="Protected Species"){K.setInfoTemplate(protectedSpeciesTemplate)}else{if(J.layerName==="Perennial Streams"){K.setInfoTemplate(pstreamTemplate)}else{if(J.layerName==="Deep Creek Lake"){K.setInfoTemplate(dclTemplate)}}}}}}}}return K},function(J){console.log("Error: "+J)})});map.infoWindow.show(E.mapPoint);map.infoWindow.setFeatures([H])}map.on("click",v);map.on("click",w);geocoders=[{url:"http://geodata.md.gov/imap/rest/services/GeocodeServices/MD_CompositeLocatorWithEsri/GeocodeServer",name:"MDiMap Composite Locator",singleLineFieldName:"SingleLine"}];geocoder=new n({map:map,geocoders:geocoders,arcgisGeocoder:false},"geosearch");geocoder.startup()});