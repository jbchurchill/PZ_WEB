var map,zoom,center,require,dojo,dijit,esri,scalebar,checkNull,formatProtectedSpecies,formatFLU,content,console,window;var saParameters,mdImageLayer,mdImageBasemap,geocoder,mapLaunchStore,comboBox;var parcelTemplate,addrTemplate,streetTemplate,pstreamTemplate,swpaTemplate,growthAreasTemplate,protectedSpeciesTemplate,SA_fLayer,basemapGallery;var passedCenter,passedX,passedY,zoomLevel;require(["esri/map","esri/dijit/Scalebar","esri/dijit/Popup","esri/dijit/BasemapGallery","dojo/store/Memory","dijit/form/ComboBox","dijit/registry","dijit/layout/BorderContainer","dijit/layout/ContentPane","dijit/TitlePane","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ImageParameters","esri/geometry/webMercatorUtils","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/Color","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/InfoTemplate","esri/dijit/Geocoder","dojo/parser","dojo/domReady!"],function(e,v,i,h,o,y,k,r,x,j,g,p,q,z,f,d,A,b,w,m,n,c){c.parse();var a=new i({fillSymbol:new f(f.STYLE_SOLID,new d(d.STYLE_SOLID,new A([255,0,0]),2),new A([255,255,0,0.25]))},dojo.create("div"));function s(){var C=dijit.byId("mapSelect").get("value"),D,B,E;switch(C){case"Measurement":D="measure.php";E="_blank";break;case"Planning and Zoning":D="pz_map.php";E="_blank";break;case"Flood Hazard":D="FEMA_map.php";E="_blank";break;case"Sensitive Areas":D="sensitive.php";E="_self";break}B=D+"?px="+passedX+"&py="+passedY+"&zl="+zoomLevel;window.open(B,E)}function l(){var B=z.webMercatorToGeographic(map.extent.getCenter());passedX=parseFloat(B.x.toFixed(5));passedY=parseFloat(B.y.toFixed(5));zoomLevel=map.getLevel()}passedCenter=[passedX,passedY];k.byId("launchButton").on("click",s);function t(){dojo.connect(map,"onExtentChange",l)}map=new e("mapDiv",{basemap:"streets",center:passedCenter,zoom:zoomLevel,infoWindow:a});scalebar=new v({map:map,attachTo:"bottom-right",scalebarStyle:"line",scalebarUnit:"english"});map.on("load",t);mapLaunchStore=new o({data:[{name:"Flood Hazard",id:"FEMA",baseURL:"FEMA_map.php"},{name:"Measurement",id:"MSMT",baseURL:"measure.php"},{name:"Planning and Zoning",id:"PZMAP",baseURL:"pz_map.php"},{name:"Sensitive Areas",id:"SENSI",baseURL:"sensitive.php"}]});comboBox=new y({id:"mapSelect",name:"map",value:"Sensitive Areas",store:mapLaunchStore,searchAttr:"name"},"mapSelect").startup();checkNull=function(C,B){function D(F,G,E){if(F=="Null"){content=""}else{if(E){if(G=='SDAT Link: <a href="'){F+='" target="_blank">LINK</a>'}F+="<br />"}content=G+F}}switch(B){case"SUBDIVSN":D(C,"Subdivision: ",true);break;case"PLAT":D(C,"Plat: ",true);break;case"BLOCK":D(C,"Block: ",true);break;case"PLTLIBER":D(C,'<hr><span class="sectionhead">Plat Reference</span><br />Liber: ',true);break;case"PLTFOLIO":D(C,"Folio: ",true);break;case"OWNNAME2":D(C," ",false);break;case"SDAT_URL":D(C,'SDAT Link: <a href="',true);break;case"DR1LIBER":D(C,'<hr><span class="sectionhead">Deed Reference</span><br />Liber: ',true);break;case"DR1FOLIO":D(C,"Folio: ",true);break;case"CITY":D(C,"City: ",true);break}return content};formatProtectedSpecies=function(C,B){if(B=="GROUP"&&C=="Null"){content=""}else{if(B=="GROUP"&&C=="GROUP 1"){content="Type: Federally Protected Species"}else{if(B=="GROUP"&&C=="GROUP 2"){content="Type: State Protected Species"}}}return content};formatFLU=function(C,B){if(B=="FLU"&&C=="Null"){content=""}else{if(B=="FLU"&&C=="A"){content=C+" &#045; Permitted Accessory Use"}else{if(B=="FLU"&&C=="AR"){content=C+" &#045; Agricultural Resource"}else{if(B=="FLU"&&C=="C"){content=C+" &#045; General Commercial"}else{if(B=="FLU"&&C=="CR1"){content=C+" &#045; Commercial Resort 1"}else{if(B=="FLU"&&C=="CR2"){content=C+" &#045; Commercial Resort 2"}else{if(B=="FLU"&&C=="LR1"){content=C+" &#045; Lake Residential 1"}else{if(B=="FLU"&&C=="LR2"){content=C+" &#045; Lake Residential 2"}else{if(B=="FLU"&&C=="N"){content=C+" &#045; Not Permitted"}else{if(B=="FLU"&&C=="P"){content=C+" &#045; Permitted by Right Use"}else{if(B=="FLU"&&C=="RR"){content=C+" &#045; Rural Resource"}else{if(B=="FLU"&&C=="SE"){content=C+" &#045; Special Exception"}else{if(B=="FLU"&&C=="TC"){content=C+" &#045; Town Center"}else{if(B=="FLU"&&C=="TR"){content=C+" &#045; Town Residential"}else{if(B=="FLU"&&C=="EC"){content=C+" &#045; Employment Center"}else{if(B=="FLU"&&C=="GC"){content=C+" &#045; General Commercial"}else{if(B=="FLU"&&C=="SR"){content=C+" &#045; Suburban Residential"}}}}}}}}}}}}}}}}}return content};parcelTemplate=new m("",'<span class="sectionhead">Layer: Parcels</span><br /><br /><hr>Address: ${ADDRESS} <br />${CITY:checkNull} Owner: ${OWNNAME1} ${OWNNAME2:checkNull} <br /> Tax Id: ${ACCTID} <br />${DR1LIBER:checkNull} ${DR1FOLIO:checkNull} <hr> ${SUBDIVSN:checkNull} ${PLAT:checkNull} ${BLOCK:checkNull} Grid: ${GRID} <br />Map: ${MAP} <br /> Parcel: ${PARCEL} <br /> Lot: ${LOT} <br /> Area: ${ACRES} Acres <br />${PLTLIBER:checkNull} ${PLTFOLIO:checkNull} <hr>Year Built: ${YRBLT_CAMA} <br /> ${SDAT_URL:checkNull}');addrTemplate=new m("Address Info",'<span class="sectionhead">Layer: Address Points</span><br /><br /><hr>Address: ${ADDRESS} <br /><br /> City: ${CITY} <br /> Zip: ${ZIP_CODE} <br /> ESN: ${ESN} <br /> Community: ${COMMUNITY} <br /> Map: ${MAP} <br /> Parcel: ${PARCEL} <br />Lot: ${LOT} <br /> Tract: ${TRACT} <br /> LU: ${LU} <br /> Key date: ${KEYDATE} <br /> Rental: ${RENTAL} <br />Rental Co.: ${RENTAL_CO} <br /> Tax Account: ${TAX_ACCOUNT_ID} <br /> Owner: ${OWNER_FIRST_NAME} ${OWNER_LAST_NAME} <br />');streetTemplate=new m("",'<span class="sectionhead">Layer: Street Centerlines</span><br /><br /><hr>Name: ${STREET_ALL} <br />Maintenance: ${MAINTENANCE} <br /> Length: ${SHAPE.len:NumberFormat(places:1)} feet <br />');pstreamTemplate=new m("",'<span class="sectionhead">Layer: Perennial Streams</span><br /><br />');swpaTemplate=new m("Source Water Info",'<span class="sectionhead">Layer: Source Water Protection Areas</span><br /><br />Water System: ${WHPAs_Me_2} <br /> Geology: ${WHPAs_Me_6} <br /> Project Info: ${WHPAs_M_11} <br /> Location: ${WHPAs_M_12} <br />Source: ${CWS_SRC_NA} <br /> Completion Date: ${CWS_COMP_D} <br /> Aquifer: ${CWS_AQUIFE} <br />');growthAreasTemplate=new m("Growth Areas Info",'<span class="sectionhead">Layer: Growth Areas</span><br /><br />Land Use: ${GENZONE} <br /> Acreage: ${ACRES:NumberFormat(places:2)} <br /> Zoning: ${FLU:formatFLU}');protectedSpeciesTemplate=new m("Protected Species Info",'<span class="sectionhead">Layer: Protected Species</span><br /><br />${GROUP:formatProtectedSpecies}');saParameters=new q();saParameters.layerIds=[0,1,2,3,4,5,6,7];saParameters.layerOption=q.LAYER_OPTION_SHOW;SA_fLayer=new g("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer",{imageParameters:saParameters,opacity:0.75});map.addLayer(SA_fLayer);basemapGallery=new h({showArcGISBasemaps:true,map:map},"basemapGallery");mdImageLayer=new p("http://geodata.md.gov/imap/rest/services/Imagery/MD_SixInchImagery/MapServer");mdImageBasemap=new esri.dijit.Basemap({layers:[mdImageLayer],title:"MD Imagery",thumbnailUrl:"http://gis.garrettcounty.org/arcgis/images/image_v2.png"});basemapGallery.add(mdImageBasemap);basemapGallery.startup();basemapGallery.on("error",function(B){console.log("basemap gallery error:  ",B)});function u(C){var F,E,B,D=new b("http://gis.garrettcounty.org:6080/arcgis/rest/services/Sensitive_Areas/Sensitive_Areas/MapServer");E=[0,1,2,3,4,5,6,7];B=new w();B.tolerance=3;B.returnGeometry=true;B.layerOption=w.LAYER_OPTION_VISIBLE;B.layerIds=E;B.width=map.width;B.height=map.height;B.geometry=C.mapPoint;B.mapExtent=map.extent;B.tolerance=3;B.SpatialReference=102100;F=D.execute(B);F.addCallback(function(G){return dojo.map(G,function(H){var I=H.feature;if(H.layerName==="addresspoints"){I.setInfoTemplate(addrTemplate)}else{if(H.layerName==="Parcels"){I.setInfoTemplate(parcelTemplate)}else{if(H.layerName==="centerlines"){I.setInfoTemplate(streetTemplate)}else{if(H.layerName==="GrowthAreas"){I.setInfoTemplate(growthAreasTemplate)}else{if(H.layerName==="Source Water Protection Areas"){I.setInfoTemplate(swpaTemplate)}else{if(H.layerName==="Protected Species"){I.setInfoTemplate(protectedSpeciesTemplate)}}}}}}return I},function(H){console.log("Error: "+H)})});map.infoWindow.show(C.mapPoint);map.infoWindow.setFeatures([F])}map.on("click",u);geocoder=new n({map:map},"geosearch");geocoder.startup()});